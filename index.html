<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Divine Path - Full Astrology & Numerology Suite</title>
  <style>
    /* Import font */
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;600&display=swap');

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      background: #10101c;
      font-family: 'Poppins', sans-serif;
      color: #eee;
      min-height: 100vh;
      padding: 25px 15px;
      user-select: none;
      display: flex;
      flex-direction: column;
      align-items: center;
      scroll-behavior: smooth;
    }

    header h1 {
      font-size: 2.8rem;
      font-weight: 700;
      margin-bottom: 8px;
      color: #ff7100;
      text-shadow: 0 0 15px #ff8d21cc;
      text-align:center;
      user-select:none;
    }

    header p.subtitle {
      font-size: 1.125rem;
      font-weight: 400;
      color: #a7a1adcc;
      margin-bottom: 30px;
      text-align: center;
    }

    /* Tabs styling */
    #tabs {
      display: flex;
      justify-content: center;
      gap: 14px;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }
    .tab-btn {
      background: none;
      border: 2px solid #ff8c13aa;
      padding: 10px 24px;
      border-radius: 40px;
      font-weight: 700;
      font-size: 1rem;
      color: #ffa832cc;
      cursor: pointer;
      transition: background-color 0.3s ease, color 0.3s ease;
      user-select:none;
      min-width: 120px;
      text-align:center;
      white-space:nowrap;
    }
    .tab-btn.active,
    .tab-btn:hover {
      background: #ffa832d0;
      color: #301a00;
      border-color: #ffa832d0;
    }

    /* Calculator section styling */
    section.calculator-section {
      background: #1b2036cc;
      border-radius: 20px;
      box-shadow: 0 0 45px #ff964bba;
      padding: 36px 50px;
      width: 100%;
      max-width: 980px;
      display: none;
      flex-direction: column;
      user-select:none;
    }
    section.calculator-section.active {
      display: flex;
    }

    /* Common form styles */
    form {
      width: 100%;
      max-width: 520px;
      margin: auto;
      margin-bottom: 24px;
    }

    label {
      display: block;
      font-weight: 600;
      color: #ffac49;
      font-size: 1rem;
      user-select:none;
    }

    input, select, button {
      margin: 8px 0 20px 0;
      width: 100%;
      padding: 14px 18px;
      border-radius: 14px;
      border: none;
      font-size: 1.1rem;
      font-family: 'Poppins', sans-serif;
      background-color: #121720;
      color: #ffc365;
      box-shadow: inset 0 0 16px #ffaa0066;
      transition: box-shadow 0.4s ease;
      user-select:none;
    }

    input:focus, select:focus {
      outline: none;
      background-color: #150f00;
      box-shadow: 0 0 30px #ffaa0055;
      color: #fff4de;
    }

    button {
      background: linear-gradient(45deg, #ffb930, #ff8321);
      font-weight: 800;
      letter-spacing: 1.3px;
      color: #4a1f00cc;
      cursor: pointer;
      box-shadow: 0 0 28px #ffb651cc;
      transition: all 0.3s ease;
      user-select:none;
    }

    button:hover {
      background: linear-gradient(45deg, #ffc64b, #ff9723);
      color: #553312;
      box-shadow: 0 0 38px #ffd870ff;
    }

    /* Chart Containers */
    #chart-container, #trad-chart-container {
      background: #121921dd;
      border-radius: 24px;
      padding: 36px 38px 46px 38px;
      box-shadow: 0 0 36px #ff964bba;
      margin-bottom: 40px;
      user-select:none;
    }
    svg {
      max-width: 100%;
      user-select:none;
    }

    .house-label {
      fill: #ffd37dcc;
      font-weight: 800;
      font-size: 22px;
      user-select:none;
      text-shadow: 0 0 16px #aa6a00cc;
    }
    .planet-text {
      fill: #ffc67e;
      font-weight: 900;
      font-size: 18px;
      user-select:none;
      text-shadow: 0 0 14px #ff9a00cc;
    }
    .planet-circle {
      fill: #ff8634;
      stroke: #ffdeb4;
      stroke-width: 2.5;
      cursor: pointer;
      filter: drop-shadow(0 0 10px #ff9a44cc);
      transform-origin: center;
      transition: all 0.4s ease;
      animation: orbit-glow 3.5s ease-in-out infinite;
      user-select:none;
    }
    .planet-circle:hover {
      fill: #fff9df;
      transform: scale(1.4);
      filter: drop-shadow(0 0 28px #ffc86bdd);
    }

    @keyframes orbit-glow {
      0% { filter: drop-shadow(0 0 10px #ff8634aa); }
      50% { filter: drop-shadow(0 0 28px #ffa151dd); }
      100% { filter: drop-shadow(0 0 10px #ff8634aa); }
    }

    /* Analysis Cards */
    #analysis, #analysis-detailed, #num-analysis, #dasha-result {
      background: #121821dd;
      border-radius: 20px;
      padding: 36px 40px;
      color: #ffc985;
      line-height: 1.6;
      font-size: 1.1rem;
      box-shadow: 0 0 26px #da9a20dd;
      margin-bottom: 45px;
      white-space: pre-line;
      user-select:none;
      max-height: 480px;
      overflow-y: auto;
      font-family: 'Poppins', sans-serif;
    }

    #btnAnalysis {
      background: #ffb442cc;
      border: none;
      padding: 16px 44px;
      border-radius: 60px;
      font-weight: 900;
      font-size: 1.15rem;
      cursor: pointer;
      box-shadow: 0 0 40px #ff9a2000;
      color: #4e2800;
      transition: background-color 0.3s ease;
      margin-bottom: 38px;
      user-select:none;
      display: none;
      max-width: 320px;
      margin-left: auto;
      margin-right: auto;
      display: block;
      text-align:center;
    }

    #btnAnalysis:hover {
      background: #ffc660ee;
      box-shadow: 0 0 60px #ffb347dd;
    }

    /* Responsive */
    @media (max-width: 720px) {
      form {
        max-width: 100%;
        padding: 20px 16px;
      }
      main {
        max-width: 100%;
      }
      #btnAnalysis {
        max-width: 100%;
        font-size: 1rem;
      }
    }
  </style>
</head>
<body>
<header>
  <h1>Divine Path</h1>
  <p class="subtitle">Tarot, Numerology & Astrology ka Full Integrated Suite</p>
</header>

<div id="tabs">
  <button class="tab-btn active" data-target="astrology">Astrology (Animated Kundli)</button>
  <button class="tab-btn" data-target="traditional-kundli">Traditional Kundli</button>
  <button class="tab-btn" data-target="numerology">Numerology Calculators</button>
  <button class="tab-btn" data-target="dasha">Dasha Calculators</button>
  <button class="tab-btn" data-target="explanations">All-In-One Explanation</button>
</div>

<main>
  <!-- Astrology Tab -->
  <section id="astrology" class="calculator-section active">
    <form id="kundliForm" autocomplete="off">
      <label for="dob">Date of Birth</label>
      <input type="date" id="dob" required />

      <label for="tob">Time of Birth (24h format)</label>
      <input type="time" id="tob" required step="60" value="12:00" />

      <label for="city">Select City (Auto-fill Latitude & Longitude)</label>
      <select id="city">
        <option value="">-- Select City --</option>
        <option value="22.5726,88.3639">Kolkata</option>
        <option value="23.9941,85.3636">Hazaribagh</option>
        <option value="23.3441,85.3096">Ranchi</option>
        <option value="28.6139,77.2090">Delhi</option>
        <option value="19.0760,72.8777">Mumbai</option>
        <option value="12.9716,77.5946">Bengaluru</option>
      </select>

      <label for="lat">Latitude</label>
      <input type="number" id="lat" placeholder="Latitude" step="0.0001" required />

      <label for="lng">Longitude</label>
      <input type="number" id="lng" placeholder="Longitude" step="0.0001" required />

      <button type="submit" id="btnGenerate">Generate Kundli & Chart</button>
    </form>
    <section id="chart-container" aria-label="Animated Kundli Chart"></section>
    <button id="btnAnalysis">Show Detailed Astrology Analysis</button>
    <section id="analysis" aria-live="polite" aria-label="Basic Astrology Summary"></section>
    <section id="analysis-detailed" style="display:none;" aria-live="polite" aria-label="Detailed Astrology Analysis"></section>
  </section>

  <!-- Traditional Kundli Tab -->
  <section id="traditional-kundli" class="calculator-section" aria-label="Traditional Kundli Section">
    <form id="tradForm" autocomplete="off">
      <label for="tradDob">Date of Birth</label>
      <input type="date" id="tradDob" required />

      <label for="tradTob">Time of Birth (24h format)</label>
      <input type="time" id="tradTob" required step="60" value="12:00" />

      <label for="tradCity">Select City (Auto-fill Latitude & Longitude)</label>
      <select id="tradCity">
        <option value="">-- Select City --</option>
        <option value="22.5726,88.3639">Kolkata</option>
        <option value="23.9941,85.3636">Hazaribagh</option>
        <option value="23.3441,85.3096">Ranchi</option>
        <option value="28.6139,77.2090">Delhi</option>
        <option value="19.0760,72.8777">Mumbai</option>
        <option value="12.9716,77.5946">Bengaluru</option>
      </select>

      <label for="tradLat">Latitude</label>
      <input type="number" id="tradLat" placeholder="Latitude" step="0.0001" required />

      <label for="tradLng">Longitude</label>
      <input type="number" id="tradLng" placeholder="Longitude" step="0.0001" required />

      <button type="submit" id="btnGenerateTrad">Generate Traditional Kundli</button>
    </form>
    <section id="trad-chart-container" style="background:#121921; border-radius: 20px; padding: 30px; box-shadow: 0 0 28px #ff7b22cc; max-width: 600px; margin: auto; user-select:none;">
      <!-- Traditional kundli SVG rendered here -->
    </section>
  </section>

  <!-- Numerology Tab -->
  <section id="numerology" class="calculator-section" aria-label="Numerology Section">
    <form id="numForm" autocomplete="off">
      <label for="numName">Full Name (English)</label>
      <input type="text" id="numName" placeholder="Full Name" autocomplete="off" required />
      <label for="numDob">Date of Birth</label>
      <input type="date" id="numDob" required />
      <button type="submit" id="btnNumCalculate">Calculate Numerology</button>
    </form>
    <section id="num-analysis" style="background:#121921;border-radius:20px; padding:30px; box-shadow: 0 0 28px #ff7b22cc; max-width:700px; margin: 24px auto 60px auto; white-space: pre-line; user-select:none;"></section>
  </section>

  <!-- Dasha Tab -->
  <section id="dasha" class="calculator-section" aria-label="Dasha Section">
    <form id="dashaForm" autocomplete="off">
      <label for="dashaDob">Date of Birth</label>
      <input type="date" id="dashaDob" required />
      <label for="dashaTob">Time of Birth (24h format)</label>
      <input type="time" id="dashaTob" required step="60" value="12:00" />
      <button type="submit" id="btnDashaCalculate">Calculate Dasha</button>
    </form>
    <section id="dasha-result" style="background:#121921; border-radius:20px; padding:30px; box-shadow: 0 0 28px #ff7b22cc; max-width:700px; margin: 24px auto 60px auto; white-space: pre-line; user-select:none;"></section>
  </section>

  <!-- Explanations Tab -->
  <section id="explanations" class="calculator-section" aria-label="Explanations Section" style="color:#ffb24c;">
    <h2 style="text-align:center; user-select:none;">सम्पूर्ण ज्योतिष और अंकशास्त्र संबंधी विवरण</h2>
    <div style="max-width:900px; margin: 0 auto; font-size:1.1rem; line-height:1.6; white-space: pre-line; user-select:none;">
      <p><strong>कुंडली (Astrology Chart):</strong> जन्म के समय ग्रहों और राशियों का लग्न से संबंध प्रस्तुत करता है। ग्रहों की दशा, योग, आदि मापदंड मंजूर किये जाते हैं।</p>

      <p><strong>पारंपरिक कुंडली:</strong> 12 घरों वाला वर्गाकार या वक्राकार तालिका जिसमें ग्रह व राशियों को परिभाषित किया जाता है। हर घर जीवन के विभिन्न पहलुओं का प्रतिनिधित्व करता है।</p>

      <p><strong>अंकशास्त्र:</strong> नाम और जन्मतिथि से निकाले गए विभिन्न अंक जैसे जीवन पथ अंक, व्यक्तित्व अंक आदि, जो व्यक्ति के स्वभाव और भविष्य का संकेत देते हैं।</p>

      <p><strong>दशा प्रणाली:</strong> ग्रहों की कालीय अवस्थाओं का विश्लेषण, विशेषकर विमशोत्तरी दशा, जिसका उपयोग भविष्यफल के लिए किया जाता है।</p>

      <p><strong>सभी गणनाएँ:</strong> उपरोक्त सभी मॉड्यूल आधुनिक ज्योतिषीय और अंकशास्त्रीय नियमों का उपयोग कर हिंदी में विस्तृत और सटीक व्याख्या के साथ प्रस्तुत किये जाते हैं। पूर्ण नियंत्रण और पारदर्शिता के लिए सारा कोड क्लाइंट-साइड सिंगल पेज एप्लिकेशन में समाहित है।</p>
    </div>
  </section>
</main>

<script>
  // Tab switching
  const tabs = document.querySelectorAll(".tab-btn");
  const sections = document.querySelectorAll(".calculator-section");
  tabs.forEach(tab => {
    tab.addEventListener("click", () => {
      tabs.forEach(t => t.classList.remove("active"));
      tab.classList.add("active");
      const target = tab.dataset.target;
      sections.forEach(s => {
        s.classList.toggle("active", s.id === target);
      });
    });
  });

  /* Common Astrology & Calculation Utilities */
  class Astronomy {
    static toJulianDay(y,m,d,h,min) {
      if(m<=2) {
        y-=1; m+=12;
      }
      const A=Math.floor(y/100), B=2-A+Math.floor(A/4);
      const dayFrac=(h+min/60)/24;
      return Math.floor(365.25*(y+4716))+Math.floor(30.6001*(m+1))+d+dayFrac+B-1524.5;
    }
    static degToRad(d) {return d*Math.PI/180;}
    static radToDeg(r) {return r*180/Math.PI;}
    static sunLongitude(JD) {
      const n=JD-2451545.0;
      const L=(280.460+0.9856474*n)%360;
      const g=(357.528+0.9856003*n)%360;
      const gRad=this.degToRad(g);
      let lambda=L+1.915*Math.sin(gRad)+0.020*Math.sin(2*gRad);
      return (lambda+360)%360;
    }
    static moonLongitude(JD) {
      const n=JD-2451550.1;
      const L=(218.316+13.176396*n)%360;
      const M=(134.963+13.064993*n)%360;
      const F=(93.272+13.229350*n)%360;
      const LRad=this.degToRad(L);
      const MRad=this.degToRad(M);
      const FRad=this.degToRad(F);
      let lambda=L+6.289*Math.sin(MRad)-3.0*Math.sin(LRad-this.degToRad(297.850))+
                 1.274*Math.sin(2*this.degToRad(L)-MRad)+0.658*Math.sin(2*LRad)+
                 0.214*Math.sin(2*MRad)-0.186*Math.sin(this.degToRad(297.850))+
                 0.114*Math.sin(2*FRad);
      return (lambda+360)%360;
    }
    static mercuryLongitude(JD) { return (252.25084 + 4.0923344368*(JD-2451545.0))%360 + 360 %360;}
    static venusLongitude(JD) { return (181.9798 + 1.6021302244*(JD-2451545.0))%360 + 360 %360;}
    static marsLongitude(JD) { return (355.433 + 0.5240207766*(JD-2451545.0))%360 + 360 %360;}
    static jupiterLongitude(JD) { return (34.3515 + 0.083091*(JD-2451545.0))%360 + 360 %360;}
    static saturnLongitude(JD) { return (50.07745 + 0.0300657*(JD-2451545.0))%360 + 360 %360;}
    static greenwichSiderealTime(JD) {
      const JD0=Math.floor(JD+0.5)-0.5;
      const S=JD0-2451545.0;
      const T=S/36525.0;
      const T0=6.697374558+2400.051336*T+0.000025862*T*T;
      const UT=(JD-JD0)*24;
      let GST=T0+UT*1.002737909;
      GST=(GST%24)*15;
      if(GST<0) GST+=360;
      return GST;
    }
  }

  /* Helpers */
  const signs = ["मेष","वृषभ","मिथुन","कर्क","सिंह","कन्या","तुला","वृश्चिक","धनु","मकर","कुम्भ","मीन"];
  function formatLongitude(lon) {
    let normLon=lon%360; if(normLon<0) normLon+=360;
    const signIndex=Math.floor(normLon/30);
    const degreeSign=normLon%30;
    return `${degreeSign.toFixed(2)}° ${signs[signIndex]}`;
  }

  /* Astrology (Animated Kundli) Logic */
  const astrologyForm=document.getElementById("kundliForm");
  const chartContainer=document.getElementById("chart-container");
  const analysisBasic=document.getElementById("analysis");
  const btnAnalysis=document.getElementById("btnAnalysis");
  const analysisDetailed=document.getElementById("analysis-detailed");

  function calculatePlanets(jd) {
    return [
      {name:"Surya",longitude:Astronomy.sunLongitude(jd)},
      {name:"Chandra",longitude:Astronomy.moonLongitude(jd)},
      {name:"Budh",longitude:Astronomy.mercuryLongitude(jd)},
      {name:"Shukra",longitude:Astronomy.venusLongitude(jd)},
      {name:"Mangal",longitude:Astronomy.marsLongitude(jd)},
      {name:"Guru",longitude:Astronomy.jupiterLongitude(jd)},
      {name:"Shani",longitude:Astronomy.saturnLongitude(jd)}
    ];
  }

  function drawChart(planets,asc,container){
    const svgNS="http://www.w3.org/2000/svg";
    container.innerHTML="";
    const size=Math.min(600,window.innerWidth-40);
    const svg=document.createElementNS(svgNS,"svg");
    svg.setAttribute("width",size);
    svg.setAttribute("height",size);
    svg.setAttribute("viewBox","0 0 600 600");
    svg.style.maxWidth="100%";
    container.appendChild(svg);

    const pts="300,20 580,300 300,580 20,300";
    const diamond=document.createElementNS(svgNS,"polygon");
    diamond.setAttribute("points",pts);
    diamond.setAttribute("stroke","#ff9b31");
    diamond.setAttribute("stroke-width","5");
    diamond.setAttribute("fill","none");
    diamond.setAttribute("filter","drop-shadow(0 0 9px #ff9b3199)");
    svg.appendChild(diamond);

    const lines=[[20,300,300,580],[300,580,580,300],[580,300,300,20],[300,20,20,300]];
    lines.forEach(([x1,y1,x2,y2])=>{
      const line=document.createElementNS(svgNS,"line");
      line.setAttribute("x1",x1);
      line.setAttribute("y1",y1);
      line.setAttribute("x2",x2);
      line.setAttribute("y2",y2);
      line.setAttribute("stroke","#ff9b31");
      line.setAttribute("stroke-width","3");
      svg.appendChild(line);
    });
    const houseCenters=[[300,125],[420,195],[455,335],[420,465],[300,525],[180,460],[145,325],[180,190],[300,300],[360,230],[300,180],[240,230]];
    const ascSignIndex=Math.floor(asc/30);
    for(let i=0;i<12;i++){
      const houseNum=((ascSignIndex+i)%12)+1;
      const [x,y]=houseCenters[i];
      const text=document.createElementNS(svgNS,"text");
      text.setAttribute("x",x);
      text.setAttribute("y",y-20);
      text.setAttribute("fill","#ff9b31");
      text.setAttribute("font-size","20");
      text.setAttribute("font-weight","900");
      text.setAttribute("text-anchor","middle");
      text.textContent=houseNum;
      svg.appendChild(text);
    }
    const cx=300,cy=300,radius=230;
    planets.forEach(({name,longitude})=>{
      const relAngle=(longitude-asc+360)%360;
      const angleRad=(relAngle-90)*Math.PI/180;
      const px=cx+radius*Math.cos(angleRad);
      const py=cy+radius*Math.sin(angleRad);
      const circle=document.createElementNS(svgNS,"circle");
      circle.setAttribute("cx",px);
      circle.setAttribute("cy",py);
      circle.setAttribute("r",20);
      circle.setAttribute("class","planet-circle");
      circle.setAttribute("title",`${name}: ${formatLongitude(longitude)}`);
      circle.style.fill="#ff7f27";
      circle.style.stroke="#ffefb1";
      svg.appendChild(circle);
      const text=document.createElementNS(svgNS,"text");
      text.setAttribute("x",px);
      text.setAttribute("y",py+40);
      text.setAttribute("fill","#ffa444");
      text.setAttribute("font-weight","900");
      text.setAttribute("font-size","16");
      text.setAttribute("text-anchor","middle");
      text.style.userSelect="none";
      text.textContent=name;
      svg.appendChild(text);
    });
  }

  astrologyForm.addEventListener("submit",e=>{
    e.preventDefault();
    const dob=astrologyForm.dob.value;
    const tob=astrologyForm.tob.value;
    const lat=parseFloat(astrologyForm.lat.value);
    const lng=parseFloat(astrologyForm.lng.value);
    if(!dob||!tob||isNaN(lat)||isNaN(lng)){
      alert("कृपया पूरी और सही जानकारी भरें।");
      return;
    }
    const [hour,minute]=tob.split(":").map(Number);
    const [year,month,day]=dob.split("-").map(Number);
    const jd=Astronomy.toJulianDay(year,month,day,hour,minute);
    const planets=calculatePlanets(jd);
    const ascendant=((()=> {
      const eps=23.4397;
      let GST=Astronomy.greenwichSiderealTime(jd);
      let LST=(GST+lng)%360;
      if(LST<0)LST+=360;
      const radLat=Astronomy.degToRad(lat);
      const radEps=Astronomy.degToRad(eps);
      const radLST=Astronomy.degToRad(LST);
      let asc=Math.atan2(-Math.cos(radLST),Math.sin(radLST)*Math.cos(radEps)-Math.tan(radLat)*Math.sin(radEps));
      if(asc<0)asc+=2*Math.PI;
      return Astronomy.radToDeg(asc);
    })());
    drawChart(planets,asc,chartContainer);
    analysisBasic.textContent=`आपका जन्म विवरण:\n- तिथि: ${dob}\n- समय: ${tob}\n- अक्षांश: ${lat.toFixed(4)}\n- देशांतर: ${lng.toFixed(4)}\n\n`+
      `उदय राशि (Ascendant): ${formatLongitude(ascendant)}\n\n`+
      `ग्रहों की स्थिति:\n`+planets.map(p=>`• ${p.name}: ${formatLongitude(p.longitude)}`).join("\n");
    btnAnalysis.style.display="block";
    analysisDetailed.style.display="none";
    analysisDetailed.textContent="";
  });

  btnAnalysis.addEventListener("click",()=>{
    let textLines=[];
    textLines.push("✨ विस्तृत kundli विश्लेषण ✨\n");
    textLines.push(analysisBasic.textContent);
    textLines.push("\nग्रहों का प्रभाव और संकेत:");
    function planetSignEffect(name,lon){
      let signIndex=Math.floor(lon/30);
      let sign=signs[signIndex];
      switch(name){
        case"Surya":return`सूर्य ${sign} राशि में होता है, जिससे नेतृत्व क्षमता और आत्मविश्वास बढ़ते हैं।`;
        case"Chandra":return`चन्द्र ${sign} राशि में है, इसका प्रभाव भावनाओं और मानसिक स्थिति पर पड़ता है।`;
        case"Budh":return`बुध ${sign} राशि में है, जिससे बुद्धि और संवाद कौशल प्रभावित होते हैं।`;
        case"Shukra":return`शुक्र ${sign} राशि में है, जो प्रेम, सौंदर्य और सामाजिक संबंधों पर प्रभाव डालता है।`;
        case"Mangal":return`मंगल ${sign} राशि में है, जो ऊर्जा और साहस को दर्शाता है।`;
        case"Guru":return`गुरु ${sign} राशि में है, जो ज्ञान और आध्यात्मिकता से जुड़ा है।`;
        case"Shani":return`शनि ${sign} राशि में होता है, अड़चनों एवं अनुशासन के कारक के रूप में जाना जाता है।`;
        default:return`${name} ग्रह के प्रभाव अध्ययनाधीन हैं।`;
      }
    }
    const ascText=analysisBasic.textContent.split("\n").find(l=>l.startsWith("उदय राशि"));
    textLines.push(ascText.replace("उदय राशि (Ascendant):","उदय राशि:"));
    const planetLines=analysisBasic.textContent.split("\n").filter(l=>l.startsWith("•"));
    planetLines.forEach(planetLine=>{
      const [pname,plong]=planetLine.replace("• ","").split(":");
      const plon=parseFloat(plong);
      if(!isNaN(plon))
        textLines.push(`- ${planetSignEffect(pname.trim(),plon)}`);
      else textLines.push(`- ${pname.trim()} ग्रह की स्थिति उपलब्ध नहीं।`);
    });
    textLines.push("\nयह विवरण मुख्य ग्रहों और उदय राशि के आधार पर प्रारंभिक संकेत प्रदान करता है।");
    textLines.push("अधिक विस्तृत ज्योतिषीय ज्ञान के लिए विशेषज्ञ ज्योतिषी से सम्पर्क करें।");
    analysisDetailed.textContent=textLines.join("\n");
    analysisDetailed.style.display="block";
    btnAnalysis.style.display="none";
    setTimeout(()=>{analysisDetailed.scrollIntoView({behavior:"smooth"})},80);
  });

  // Traditional Kundli Section (Advanced with houses and planet positions in houses)
  const tradForm=document.getElementById("tradForm");
  const tradChartContainer=document.getElementById("trad-chart-container");
  const tradCitySelect=document.getElementById("tradCity");
  const tradLatInput=document.getElementById("tradLat");
  const tradLngInput=document.getElementById("tradLng");
  tradCitySelect.addEventListener("change",e=>{
    const val=e.target.value;
    if(val){
      const [lat,lng]=val.split(",");
      tradLatInput.value=lat;
      tradLngInput.value=lng;
    }
  });

  tradForm.addEventListener("submit",e=>{
    e.preventDefault();
    const dob=tradForm.tradDob.value;
    const tob=tradForm.tradTob.value;
    const lat=parseFloat(tradForm.tradLat.value);
    const lng=parseFloat(tradForm.tradLng.value);
    if(!dob||!tob||isNaN(lat)||isNaN(lng)){
      alert("कृपया सही जन्म विवरण भरें।");
      return;
    }
    const [hour,minute]=tob.split(":").map(Number);
    const [year,month,day]=dob.split("-").map(Number);
    const JD=Astronomy.toJulianDay(year,month,day,hour,minute);

    const ascendant=(function(JD,lat,lon){
      const eps=23.4397;
      let GST=Astronomy.greenwichSiderealTime(JD);
      let LST=(GST+lon)%360;
      if(LST<0) LST+=360;
      const radLat=Astronomy.degToRad(lat);
      const radEps=Astronomy.degToRad(eps);
      const radLST=Astronomy.degToRad(LST);
      let asc=Math.atan2(-Math.cos(radLST),Math.sin(radLST)*Math.cos(radEps)-Math.tan(radLat)*Math.sin(radEps));
      if(asc<0)asc+=2*Math.PI;
      return Astronomy.radToDeg(asc);
    })(JD,lat,lng);

    const planets=calculatePlanets(JD);
    // House assignments -- equal houses from ascendant as house 1
    let houses=Array.from({length:12},()=>[]);
    planets.forEach(p=>{
      let diff=p.longitude-ascendant;
      if(diff<0) diff+=360;
      let houseNum=Math.floor(diff/30);
      houses[houseNum].push(p.name);
    });

    renderTraditionalKundli(houses, tradChartContainer);
  });

  function renderTraditionalKundli(houses, container) {
    container.innerHTML="";
    const div=document.createElement("div");
    div.style.position="relative";
    div.style.width="600px";
    div.style.height="600px";
    div.style.margin="auto";
    const svgNS="http://www.w3.org/2000/svg";
    const svg=document.createElementNS(svgNS,"svg");
    svg.setAttribute("width","600");
    svg.setAttribute("height","600");
    svg.style.position="absolute";
    svg.style.top=0; svg.style.left=0; svg.style.zIndex=1;
    const diamondPoints="300,20 580,300 300,580 20,300";
    const diamond=document.createElementNS(svgNS,"polygon");
    diamond.setAttribute("points",diamondPoints);
    diamond.setAttribute("stroke","#ffa832");
    diamond.setAttribute("stroke-width","5");
    diamond.setAttribute("fill","none");
    diamond.setAttribute("filter","drop-shadow(0 0 12px #ffa832cc)");
    svg.appendChild(diamond);
    div.appendChild(svg);

    const houseCenters=[[300,125],[420,195],[455,335],[420,465],[300,525],[180,460],
                        [145,325],[180,190],[300,300],[360,230],[300,180],[240,230]];

    houses.forEach((planets,i)=>{
      const houseDiv=document.createElement("div");
      houseDiv.style.position="absolute";
      houseDiv.style.left=houseCenters[i][0]-75+"px";
      houseDiv.style.top=houseCenters[i][1]-60+"px";
      houseDiv.style.width="150px";
      houseDiv.style.height="110px";
      houseDiv.style.border="2px solid #ffb14f";
      houseDiv.style.borderRadius="22px";
      houseDiv.style.background="rgba(255,168,80,0.18)";
      houseDiv.style.color="#ffc973";
      houseDiv.style.fontWeight="700";
      houseDiv.style.fontSize="20px";
      houseDiv.style.textAlign="center";
      houseDiv.style.paddingTop="8px";
      houseDiv.style.textShadow="0 0 9px #b77a00cc";
      houseDiv.style.userSelect="none";

      let houseNumLabel=document.createElement("div");
      houseNumLabel.textContent=`घर ${i+1}`;
      houseNumLabel.style.fontSize="19px";
      houseNumLabel.style.fontWeight="800";
      houseNumLabel.style.color="#ff9c30";
      houseNumLabel.style.textShadow="0 0 9px #cc7f2d";
      houseDiv.appendChild(houseNumLabel);

      if(planets.length===0){
        let noPlanet=document.createElement("div");
        noPlanet.textContent="कोई ग्रह नहीं";
        noPlanet.style.fontSize="17px";
        noPlanet.style.color="#fbba51";
        houseDiv.appendChild(noPlanet);
      } else {
        planets.forEach(p=>{
          let pDiv=document.createElement("div");
          pDiv.textContent=p;
          pDiv.style.fontSize="18px";
          pDiv.style.color="#ffe3a3";
          pDiv.style.marginTop="2px";
          houseDiv.appendChild(pDiv);
        });
      }
      div.appendChild(houseDiv);
    });
    container.appendChild(div);
  }

  /* Numerology Section */
  const numForm=document.getElementById("numForm");
  const numAnalysis=document.getElementById("num-analysis");

  numForm.addEventListener("submit",e=>{
    e.preventDefault();
    const name=numForm.numName.value.trim().toLowerCase();
    const dob=numForm.numDob.value;
    if(!name||!dob){
      alert("कृपया नाम और जन्मतिथि दर्ज करें।");
      return;
    }
    let result = calculateFullNumerology(name,dob);
    numAnalysis.textContent=result;
  });

  // Full numerology calculations returning detailed report
  function calculateFullNumerology(name,dob){
    // Helper functions inside
    function sumToSingleDigit(arr){
      let total=arr.reduce((a,b)=>a+b,0);
      while(total>9 && total!==11 && total!==22){
        total=total.toString().split("").reduce((a,b)=>a+parseInt(b),0);
      }
      return total;
    }
    function letterToNumber(ch){
      const map={
        a:1,b:2,c:3,d:4,e:5,f:6,g:7,h:8,i:9,
        j:1,k:2,l:3,m:4,n:5,o:6,p:7,q:8,r:9,
        s:1,t:2,u:3,v:4,w:5,x:6,y:7,z:8
      };
      return map[ch]||0;
    }
    function numerologyDesc(num){
      const dict={
        1:"नेतृत्व, स्वतंत्रता, रचनात्मकता, महत्वाकांक्षा।",
        2:"सहयोग, संतुलन, संवेदनशीलता, शांति।",
        3:"संचार, आनंद, अभिव्यक्ति, रचनात्मकता।",
        4:"मेहनत, प्रतिबद्धता, संगठन।",
        5:"स्वतंत्रता, उत्साह, साहस, लचीलापन।",
        6:"करुणा, नैतिकता, जिम्मेदारी।",
        7:"आध्यात्मिकता, विश्लेषण, बुद्धिमत्ता।",
        8:"शक्ति, सफलता, वित्तीय बुद्धिमत्ता।",
        9:"मानवता, सहानुभूति, उदारता।",
        11:"उच्च चेतना, प्रेरक, प्रकाश।",
        22:"महान निर्माता, गुरु, मैल का सर्वोच्च दिन।"
      };
      return dict[num]||"विस्तृत विवरण उपलब्ध नहीं।";
    }

    const digits=dob.replace(/\D/g,"").split("").map(n=>parseInt(n));
    const lifePath=sumToSingleDigit(digits);

    const charNums=name.replace(/[^a-z]/g,"").split("").map(letterToNumber);
    const expressionNum=sumToSingleDigit(charNums);

    // Soul Urge = vowels in name
    const vowels="aeiou";
    const soulNums=name.split("").filter(ch=>vowels.includes(ch)).map(letterToNumber);
    const soulUrgeNum=sumToSingleDigit(soulNums);

    // Karmic Debt Numbers detection (13,14,16,19 special)
    const karmicDebts=[13,14,16,19];
    const karmicDetections=karmicDebts.filter(n=>charNums.includes(n));

    // Pinnacle Numbers Examples (lifeless but demo purpose)
    const pinnacle1=lifePath%9||9;
    const pinnacle2=expressionNum%9||9;

    let result=`🔢 Numerology Detailed Report:\n\n`;
    result+=`• Life Path Number (ज़िंदगी का मार्ग): ${lifePath}\n  विशेषता: ${numerologyDesc(lifePath)}\n\n`;
    result+=`• Expression Number (व्यक्तित्व अंक): ${expressionNum}\n  विशेषता: ${numerologyDesc(expressionNum)}\n\n`;
    result+=`• Soul Urge Number (आत्मा इच्छा अंक): ${soulUrgeNum}\n  विशेषता: ${numerologyDesc(soulUrgeNum)}\n\n`;

    if(karmicDetections.length>0){
      result+=`• Karmic Debt Numbers (कार्मिक ऋण): ${karmicDetections.join(", ")}\n  ये आपके आत्मिक यात्राओं का संकेत देते हैं।\n\n`;
    } else{
      result+=`• Karmic Debt Numbers: Not detected\n\n`;
    }

    result+=`• Pinnacle Numbers (जीवन के महत्वपूर्ण पड़ाव):\n   पहला पड़ाव: ${pinnacle1}\n   दूसरा पड़ाव: ${pinnacle2}\n\n`;
    result+=`⚠️ कृपया ध्यान दें, पूर्ण समग्र अध्ययन के लिए विशेषज्ञ से संपर्क करें।`;
    return result;
  }

  /* Dasha Section */
  const dashaForm=document.getElementById("dashaForm");
  const dashaResult=document.getElementById("dasha-result");

  dashaForm.addEventListener("submit",e=>{
    e.preventDefault();
    const dob=dashaForm.dashaDob.value;
    const tob=dashaForm.dashaTob.value;
    if(!dob||!tob){
      alert("कृपया जन्म की तिथि एवं समय सही भरें।");
      return;
    }
    const [year,month,day]=dob.split("-").map(Number);
    const [hour,minute]=tob.split(":").map(Number);
    const JD=Astronomy.toJulianDay(year,month,day,hour,minute);

    // Simplified Moon longitude nakshatra & Vimshottari Dasha
    const moonLon=Astronomy.moonLongitude(JD);
    const nakshatraNum=Math.floor(moonLon/(360/27));
    const dashaList=[
      {name:"केतु",duration:7},
      {name:"शनि",duration:19},
      {name:"बुध",duration:17},
      {name:"गुरु",duration:16},
      {name:"शुक्र",duration:20},
      {name:"सूर्य",duration:6},
      {name:"चन्द्र",duration:10},
      {name:"मंगल",duration:7},
      {name:"राहु",duration:18}
    ];

    let startIndex=nakshatraNum%9;
    let text="✨ Vimshottari Dasha प्रारंभिक स्थिति ✨\n\n";
    text+=`जन्म नक्षत्र संख्या: ${nakshatraNum+1}\n\nडशा सूची (वर्षों में):\n`;

    for(let i=0;i<9;i++){
      let idx=(startIndex+i)%9;
      const d=dashaList[idx];
      text+=`- ${d.name}: ${d.duration} वर्ष\n`;
    }
    text+=`\nयह सरलीकृत डशा गणना है। विस्तृत ज्योतिषीय परिणामों के लिए विशेषज्ञ से सलाह लें।`;
    dashaResult.textContent=text;
  });
</script>
</body>
</html>
