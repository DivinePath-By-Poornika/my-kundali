<!DOCTYPE html>
<html lang="hi">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Divine Path - Premium Astrology & Numerology</title>
  <style>
    /* Google font */
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;600&display=swap');

    /* Global resets and body styling */
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      background: #10101c;
      font-family: 'Poppins', sans-serif;
      color: #eee;
      min-height: 100vh;
      padding: 25px 15px;
      user-select: none;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    header h1 {
      font-size: 2.8rem;
      font-weight: 700;
      margin-bottom: 8px;
      color: #ff7100;
      text-shadow: 0 0 15px #ff8d21cc;
      text-align: center;
      user-select:none;
    }

    header p.subtitle {
      font-size: 1.125rem;
      font-weight: 400;
      color: #a7a1adcc;
      margin-bottom: 30px;
      text-align: center;
    }

    /* Container styling */
    form {
      background: #1b2036;
      border-radius: 18px;
      max-width: 540px;
      width: 100%;
      padding: 30px 40px;
      box-shadow: 0 0 50px #ff7a1d88;
      transition: box-shadow 0.3s ease;
      user-select:none;
    }

    form:hover {
      box-shadow: 0 0 70px #ff8a2fdd;
    }

    label {
      display: block;
      font-weight: 600;
      color: #ffac49;
      font-size: 1rem;
      user-select:none;
    }

    input,
    select,
    button {
      margin-top: 6px;
      margin-bottom: 20px;
      width: 100%;
      padding: 14px 18px;
      border-radius: 14px;
      border: none;
      font-size: 1.1rem;
      font-family: 'Poppins', sans-serif;
      background-color: #121720;
      color: #ffc365;
      box-shadow: inset 0 0 20px #ffaa0066;
      transition: box-shadow 0.35s ease;
      user-select:none;
    }

    input:focus,
    select:focus {
      outline: none;
      background-color: #150f00;
      box-shadow: 0 0 25px #ffaa0055;
      color: #fff4de;
    }

    button {
      background: linear-gradient(45deg, #ffb930, #ff8321);
      font-weight: 800;
      letter-spacing: 1.5px;
      color: #4a1f00cc;
      cursor: pointer;
      box-shadow: 0 0 20px #ffb441cc;
      transition: background 0.3s ease;
    }

    button:hover {
      background: linear-gradient(45deg, #ffc64b, #ff9723);
      color: #553112;
      box-shadow: 0 0 30px #ffd870ff;
    }

    main {
      margin-top: 42px;
      max-width: 1080px;
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      user-select:none;
    }

    /* Tab buttons container */
    #tabs {
      display: flex;
      justify-content: center;
      gap: 14px;
      margin-bottom: 26px;
    }

    .tab-btn {
      background: none;
      border: 2px solid #ff8c13aa;
      padding: 10px 18px;
      border-radius: 40px;
      font-weight: 700;
      font-size: 1rem;
      color: #ffa832cc;
      cursor: pointer;
      transition: background-color 0.3s ease, color 0.3s ease;
      user-select:none;
    }

    .tab-btn.active,
    .tab-btn:hover {
      background: #ffa832d0;
      color: #301a00;
      border-color: #ffa832d0;
    }

    section.calculator-section {
      display: none;
      background: #1b223dcc;
      border-radius: 25px;
      box-shadow: 0 0 35px #ffb655aa;
      padding: 28px 40px;
      width: 100%;
      max-width: 960px;
      user-select:none;
    }

    section.calculator-section.active {
      display: block;
    }

    /* Chart container style */
    #chart-container {
      background: #121720dd;
      border-radius: 24px;
      padding: 26px 30px 46px 30px;
      box-shadow: 0 0 36px #ff964bba;
      margin-bottom: 24px;
      user-select:none;
    }

    svg {
      max-width: 100%;
      user-select:none;
    }

    .house-label {
      fill: #ffd37dcc;
      font-weight: 800;
      font-size: 20px;
      user-select:none;
      text-shadow: 0 0 15px #aa6a00cc;
    }

    .planet-text {
      fill: #ffc67e;
      font-weight: 900;
      font-size: 18px;
      user-select:none;
      text-shadow: 0 0 14px #ff9a00cc;
    }

    .planet-circle {
      fill: #ff8634;
      stroke: #fff5e8;
      stroke-width: 2.5;
      cursor: pointer;
      filter: drop-shadow(0 0 10px #ff9a44cc);
      transform-origin: center;
      transition: all 0.4s ease;
      animation: orbit-glow 3.5s ease-in-out infinite;
      user-select:none;
    }

    .planet-circle:hover {
      fill: #fff9df;
      transform: scale(1.4);
      filter: drop-shadow(0 0 26px #ffc86bdd);
    }

    @keyframes orbit-glow {
      0% {
        filter: drop-shadow(0 0 10px #ff8634aa);
      }

      50% {
        filter: drop-shadow(0 0 28px #ffa151dd);
      }

      100% {
        filter: drop-shadow(0 0 10px #ff8634aa);
      }
    }

    /* Analysis cards */
    #analysis,
    #analysis-detailed {
      background: #121820dd;
      border-radius: 20px;
      padding: 32px 34px;
      color: #ffc985;
      line-height: 1.55;
      font-size: 1.1rem;
      box-shadow: 0 0 26px #da9a20dd;
      margin-bottom: 35px;
      white-space: pre-line;
      user-select:none;
      max-height: 450px;
      overflow-y: auto;
    }

    #btnAnalysis {
      background: #ffb442cc;
      border: none;
      padding: 16px 36px;
      border-radius: 60px;
      font-weight: 900;
      font-size: 1.15rem;
      cursor: pointer;
      box-shadow: 0 0 40px #ff9a2000;
      color: #4e2800;
      transition: background-color 0.3s ease;
      margin-bottom: 35px;
      user-select:none;
      display: none;
    }

    #btnAnalysis:hover {
      background: #ffc660ee;
      box-shadow: 0 0 60px #ffb347dd;
    }


    /* Responsive */
    @media (max-width: 720px) {
      form {
        max-width: 100%;
        padding: 20px 16px;
      }

      main {
        max-width: 100%;
      }
    }
  </style>
</head>

<body>
  <header>
    <h1>Divine Path</h1>
    <p class="subtitle">Tarot, Numerology & Astrology Ke Sath Advanced Kundli & Predictions</p>
  </header>

  <div id="tabs">
    <button class="tab-btn active" data-target="astrology">Astrology (Kundli)</button>
    <button class="tab-btn" data-target="traditional-kundli">Traditional Kundli</button>
    <button class="tab-btn" data-target="numerology">Numerology</button>
    <button class="tab-btn" data-target="dasha">Dasha Calculator</button>
  </div>

  <main>
    <!-- Astrology (Animated Kundli) Section -->
    <section id="astrology" class="calculator-section active">
      <form id="kundliForm" autocomplete="off">
        <label for="dob">Date of Birth</label>
        <input type="date" id="dob" required />

        <label for="tob">Time of Birth (24h format)</label>
        <input type="time" id="tob" required step="60" value="12:00" />

        <label for="city">Select City (Auto-fill Latitude & Longitude)</label>
        <select id="city">
          <option value="">-- Select City --</option>
          <option value="22.5726,88.3639">Kolkata</option>
          <option value="23.9941,85.3636">Hazaribagh</option>
          <option value="23.3441,85.3096">Ranchi</option>
          <option value="28.6139,77.2090">Delhi</option>
          <option value="19.0760,72.8777">Mumbai</option>
          <option value="12.9716,77.5946">Bengaluru</option>
        </select>

        <label for="lat">Latitude</label>
        <input type="number" id="lat" placeholder="Latitude" step="0.0001" required />

        <label for="lng">Longitude</label>
        <input type="number" id="lng" placeholder="Longitude" step="0.0001" required />

        <button type="submit" id="btnGenerate">Generate Kundli & Chart</button>
      </form>

      <section id="chart-container" aria-label="Kundli Chart"></section>

      <button id="btnAnalysis">Show Detailed Analysis</button>

      <section id="analysis" aria-live="polite" aria-label="Basic Kundli Summary"></section>

      <section id="analysis-detailed" style="display:none;" aria-live="polite" aria-label="Detailed Kundli Analysis"></section>
    </section>

    <!-- Traditional Kundli Section -->
    <section id="traditional-kundli" class="calculator-section" aria-label="Traditional Kundli">
      <h2 style="color:#ff7700; text-align:center; margin-bottom: 30px; user-select:none;">Traditional Kundli Chart</h2>
      <form id="tradForm" autocomplete="off" style="max-width: 500px; margin: 0 auto 20px auto; user-select:none;">
        <label for="tradDob">Date of Birth</label>
        <input type="date" id="tradDob" required />

        <label for="tradTob">Time of Birth (24h format)</label>
        <input type="time" id="tradTob" required step="60" value="12:00" />

        <label for="tradCity">Select City (Auto-fill Latitude & Longitude)</label>
        <select id="tradCity">
          <option value="">-- Select City --</option>
          <option value="22.5726,88.3639">Kolkata</option>
          <option value="23.9941,85.3636">Hazaribagh</option>
          <option value="23.3441,85.3096">Ranchi</option>
          <option value="28.6139,77.2090">Delhi</option>
          <option value="19.0760,72.8777">Mumbai</option>
          <option value="12.9716,77.5946">Bengaluru</option>
        </select>

        <label for="tradLat">Latitude</label>
        <input type="number" id="tradLat" placeholder="Latitude" step="0.0001" required />

        <label for="tradLng">Longitude</label>
        <input type="number" id="tradLng" placeholder="Longitude" step="0.0001" required />

        <button type="submit" id="btnGenerateTrad">Generate Traditional Kundli</button>
      </form>

      <section id="trad-chart-container" style="background:#121921; border-radius: 20px; padding: 30px; box-shadow: 0 0 28px #ff7b22cc; max-width: 600px; margin: auto; user-select:none;">
        <!-- Traditional kundli SVG or Canvas rendered here -->
      </section>
    </section>

    <!-- Numerology Section -->
    <section id="numerology" class="calculator-section" aria-label="Numerology Calculators">
      <h2 style="color:#ff7700; text-align:center; margin-bottom: 24px; user-select:none;">Numerology Calculator</h2>
      <form id="numForm" style="max-width: 500px; margin: 0 auto;" autocomplete="off" >
        <label for="numName">Full Name (English letters)</label>
        <input type="text" id="numName" autocomplete="off" placeholder="Type Full Name here" required />

        <label for="numDob">Date of Birth</label>
        <input type="date" id="numDob" required />

        <button type="submit" id="btnNumCalculate">Calculate Numerology</button>
      </form>

      <section id="num-analysis" style="background:#121921; border-radius: 20px; padding: 30px; box-shadow: 0 0 28px #ff7b22cc; max-width: 700px; margin: 24px auto 60px auto; white-space: pre-line; user-select:none;"></section>
    </section>

    <!-- Dasha Section -->
    <section id="dasha" class="calculator-section" aria-label="Dasha Calculator">
      <h2 style="color:#ff7700; text-align:center; margin-bottom: 24px; user-select:none;">Vimshottari Dasha Calculator (Simplified)</h2>
      <form id="dashaForm" style="max-width: 500px; margin: 0 auto;" autocomplete="off">
        <label for="dashaDob">Date of Birth</label>
        <input type="date" id="dashaDob" required />

        <label for="dashaTob">Time of Birth (24h format)</label>
        <input type="time" id="dashaTob" required step="60" value="12:00" />

        <button type="submit" id="btnDashaCalculate">Calculate Dasha</button>
      </form>

      <section id="dasha-result" style="background:#121921;border-radius:20px;padding:30px;box-shadow: 0 0 28px #ff7b22cc;max-width:700px;margin: 24px auto 60px auto; white-space: pre-line; user-select:none;"></section>
    </section>
  </main>

  <script>
    // TAB SWITCHING
    const tabs = document.querySelectorAll(".tab-btn");
    const sections = document.querySelectorAll(".calculator-section");

    tabs.forEach(tab => {
      tab.addEventListener("click", () => {
        tabs.forEach(t => t.classList.remove("active"));
        tab.classList.add("active");
        const target = tab.dataset.target;
        sections.forEach(s => {
          s.classList.toggle("active", s.id === target);
        });
      });
    });

    // === COMMON UTILITIES ===
    class Astronomy {
      static toJulianDay(year, month, day, hour, minute) {
        if (month <= 2) {
          year -= 1; month += 12;
        }
        const A = Math.floor(year/100);
        const B = 2 - A + Math.floor(A/4);
        const dayFraction = (hour + minute/60)/24;
        return Math.floor(365.25*(year + 4716)) + Math.floor(30.6001*(month + 1)) + day + dayFraction + B - 1524.5;
      }
      static degToRad(d) { return d * Math.PI / 180; }
      static radToDeg(r) { return r * 180 / Math.PI; }
      static sunLongitude(JD) {
        const n = JD - 2451545.0;
        const L = (280.460 + 0.9856474 * n) % 360;
        const g = (357.528 + 0.9856003 * n) % 360;
        const gRad = this.degToRad(g);
        let lambda = L + 1.915 * Math.sin(gRad) + 0.020 * Math.sin(2 * gRad);
        return (lambda + 360) % 360;
      }
      static moonLongitude(JD) {
        const n = JD - 2451550.1;
        const L = (218.316 + 13.176396 * n) % 360;
        const M = (134.963 + 13.064993 * n) % 360;
        const F = (93.272 + 13.229350 * n) % 360;
        const LRad = this.degToRad(L);
        const MRad = this.degToRad(M);
        const FRad = this.degToRad(F);

        let lambda = L + 6.289 * Math.sin(MRad) - 3.0 * Math.sin(LRad - this.degToRad(297.850)) + 1.274 * Math.sin(2 * this.degToRad(L) - MRad)
          + 0.658 * Math.sin(2 * LRad) + 0.214 * Math.sin(2 * MRad) - 0.186 * Math.sin(this.degToRad(297.850)) + 0.114 * Math.sin(2 * FRad);
        return (lambda + 360) % 360;
      }
      static mercuryLongitude(JD) {
        const n = JD - 2451545.0;
        let L = (252.25084 + 4.0923344368 * n) % 360;
        return (L + 360) % 360;
      }
      static venusLongitude(JD) {
        const n = JD - 2451545.0;
        let L = (181.9798 + 1.6021302244 * n) % 360;
        return (L + 360) % 360;
      }
      static marsLongitude(JD) {
        const n = JD - 2451545.0;
        let L = (355.433 + 0.5240207766 * n) % 360;
        return (L + 360) % 360;
      }
      static jupiterLongitude(JD) {
        const n = JD - 2451545.0;
        let L = (34.3515 + 0.083091 * n) % 360;
        return (L + 360) % 360;
      }
      static saturnLongitude(JD) {
        const n = JD - 2451545.0;
        let L = (50.07745 + 0.0300657 * n) % 360;
        return (L + 360) % 360;
      }
      static greenwichSiderealTime(JD) {
        const JD0 = Math.floor(JD + 0.5) - 0.5;
        const S = JD0 - 2451545.0;
        const T = S / 36525.0;
        const T0 = 6.697374558 + 2400.051336 * T + 0.000025862 * T * T;
        const UT = (JD - JD0) * 24;
        let GST = T0 + UT * 1.002737909;
        GST = (GST % 24) * 15;
        if (GST < 0) GST += 360;
        return GST;
      }
    }

    const signs = ["मेष", "वृषभ", "मिथुन", "कर्क", "सिंह", "कन्या", "तुला", "वृश्चिक", "धनु", "मकर", "कुम्भ", "मीन"];

    function formatLongitude(lon) {
      let normLon = lon % 360;
      if (normLon < 0) normLon += 360;
      const signIndex = Math.floor(normLon / 30);
      const degreeSign = normLon % 30;
      return `${degreeSign.toFixed(2)}° ${signs[signIndex]}`;
    }

    /* === Astrology Main Kundli Tab Code === */
    const astrologyForm = document.getElementById("kundliForm");
    const chartContainer = document.getElementById("chart-container");
    const analysisBasic = document.getElementById("analysis");
    const btnAnalysis = document.getElementById("btnAnalysis");
    const analysisDetailed = document.getElementById("analysis-detailed");

    function calculatePlanets(jd) {
      return [
        { name: "Surya", longitude: Astronomy.sunLongitude(jd) },
        { name: "Chandra", longitude: Astronomy.moonLongitude(jd) },
        { name: "Budh", longitude: Astronomy.mercuryLongitude(jd) },
        { name: "Shukra", longitude: Astronomy.venusLongitude(jd) },
        { name: "Mangal", longitude: Astronomy.marsLongitude(jd) },
        { name: "Guru", longitude: Astronomy.jupiterLongitude(jd) },
        { name: "Shani", longitude: Astronomy.saturnLongitude(jd) }
      ];
    }

    function drawChart(planets, asc, container) {
      const svgNS = "http://www.w3.org/2000/svg";
      container.innerHTML = "";
      const size = Math.min(600, window.innerWidth - 40);
      const svg = document.createElementNS(svgNS, "svg");
      svg.setAttribute("width", size);
      svg.setAttribute("height", size);
      svg.setAttribute("viewBox", "0 0 600 600");
      svg.style.maxWidth = "100%";
      container.appendChild(svg);
      const pts = "300,20 580,300 300,580 20,300";
      const diamond = document.createElementNS(svgNS, "polygon");
      diamond.setAttribute("points", pts);
      diamond.setAttribute("stroke", "#ff9b31");
      diamond.setAttribute("stroke-width", "5");
      diamond.setAttribute("fill", "none");
      diamond.setAttribute("filter", "drop-shadow(0 0 9px #ff9b3199)");
      svg.appendChild(diamond);
      const lines = [
        [20, 300, 300, 580],
        [300, 580, 580, 300],
        [580, 300, 300, 20],
        [300, 20, 20, 300]
      ];
      lines.forEach(([x1, y1, x2, y2]) => {
        const line = document.createElementNS(svgNS, "line");
        line.setAttribute("x1", x1);
        line.setAttribute("y1", y1);
        line.setAttribute("x2", x2);
        line.setAttribute("y2", y2);
        line.setAttribute("stroke", "#ff9b31");
        line.setAttribute("stroke-width", "3");
        svg.appendChild(line);
      });
      const houseCenters = [
        [300, 125], [420, 195], [455, 335], [420, 465], [300, 525], [180, 460],
        [145, 325], [180, 190], [300, 300], [360, 230], [300, 180], [240, 230]
      ];
      const ascSignIndex = Math.floor(asc / 30);
      for (let i = 0; i < 12; i++) {
        const houseNum = ((ascSignIndex + i) % 12) + 1;
        const [x, y] = houseCenters[i];
        const text = document.createElementNS(svgNS, "text");
        text.setAttribute("x", x);
        text.setAttribute("y", y - 20);
        text.setAttribute("fill", "#ff9b31");
        text.setAttribute("font-size", "20");
        text.setAttribute("font-weight", "900");
        text.setAttribute("text-anchor", "middle");
        text.textContent = houseNum;
        svg.appendChild(text);
      }
      const cx = 300, cy = 300, radius = 230;
      planets.forEach(({ name, longitude }) => {
        const relAngle = (longitude - asc + 360) % 360;
        const angleRad = (relAngle - 90) * Math.PI / 180;
        const px = cx + radius * Math.cos(angleRad);
        const py = cy + radius * Math.sin(angleRad);
        const circle = document.createElementNS(svgNS, "circle");
        circle.setAttribute("cx", px);
        circle.setAttribute("cy", py);
        circle.setAttribute("r", 20);
        circle.setAttribute("class", "planet-circle");
        circle.setAttribute("title", `${name}: ${formatLongitude(longitude)}`);
        circle.style.fill = "#ff7f27";
        circle.style.stroke = "#ffefb1";
        svg.appendChild(circle);
        const text = document.createElementNS(svgNS, "text");
        text.setAttribute("x", px);
        text.setAttribute("y", py + 40);
        text.setAttribute("fill", "#ffa444");
        text.setAttribute("font-weight", "900");
        text.setAttribute("font-size", "16");
        text.setAttribute("text-anchor", "middle");
        text.style.userSelect = "none";
        text.textContent = name;
        svg.appendChild(text);
      });
    }

    astrologyForm.addEventListener("submit", e => {
      e.preventDefault();

      const dob = astrologyForm.dob.value;
      const tob = astrologyForm.tob.value;
      const lat = parseFloat(astrologyForm.lat.value);
      const lng = parseFloat(astrologyForm.lng.value);

      if (!dob || !tob || isNaN(lat) || isNaN(lng)) {
        alert("कृपया पूरी और सही जानकारी भरें।");
        return;
      }

      const [hour, minute] = tob.split(":").map(Number);
      const [year, month, day] = dob.split("-").map(Number);
      const jd = Astronomy.toJulianDay(year, month, day, hour, minute);

      const planets = calculatePlanets(jd);
      const ascendant = (function (jd, lat, lon) {
        const eps = 23.4397;
        let GST = Astronomy.greenwichSiderealTime(jd);
        let LST = (GST + lon) % 360;
        if (LST < 0) LST += 360;
        const radLat = Astronomy.degToRad(lat);
        const radEps = Astronomy.degToRad(eps);
        const radLST = Astronomy.degToRad(LST);
        let asc = Math.atan2(-Math.cos(radLST), Math.sin(radLST) * Math.cos(radEps) - Math.tan(radLat) * Math.sin(radEps));
        if (asc < 0) asc += 2 * Math.PI;
        return Astronomy.radToDeg(asc);
      })(jd, lat, lng);

      drawChart(planets, ascendant, chartContainer);

      analysisBasic.textContent = `आपका जन्म विवरण:\n- तिथि: ${dob}\n- समय: ${tob}\n- अक्षांश: ${lat.toFixed(4)}\n- देशांतर: ${lng.toFixed(4)}\n\n` +
        `उदय राशि (Ascendant): ${formatLongitude(ascendant)}\n\n` +
        `ग्रहों की स्थिति:\n` + planets.map(p => `• ${p.name}: ${formatLongitude(p.longitude)}`).join("\n");

      btnAnalysis.style.display = "block";
      analysisDetailed.style.display = "none";
      analysisDetailed.textContent = "";
    });

    btnAnalysis.addEventListener("click", () => {
      let textLines = [];
      textLines.push("✨ विस्तृत kundli विश्लेषण ✨\n");
      textLines.push(analysisBasic.textContent);
      textLines.push("\nग्रहों का प्रभाव और संकेत:");

      function planetSignEffect(name, lon) {
        let signIndex = Math.floor(lon / 30);
        let sign = signs[signIndex];
        switch (name) {
          case "Surya":
            return `सूर्य ${sign} राशि में होता है, जिससे नेतृत्व क्षमता और आत्मविश्वास बढ़ते हैं।`;
          case "Chandra":
            return `चन्द्र ${sign} राशि में है, इसका प्रभाव भावनाओं और मानसिक स्थिति पर पड़ता है।`;
          case "Budh":
            return `बुध ${sign} राशि में है, जिससे बुद्धि और संवाद कौशल प्रभावित होते हैं।`;
          case "Shukra":
            return `शुक्र ${sign} राशि में है, जो प्रेम, सौंदर्य और सामाजिक संबंधों पर प्रभाव डालता है।`;
          case "Mangal":
            return `मंगल ${sign} राशि में है, जो ऊर्जा और साहस को दर्शाता है।`;
          case "Guru":
            return `गुरु ${sign} राशि में है, जो ज्ञान और आध्यात्मिकता से जुड़ा है।`;
          case "Shani":
            return `शनि ${sign} राशि में होता है, अड़चनों एवं अनुशासन के कारक के रूप में जाना जाता है।`;
          default:
            return `${name} ग्रह के प्रभाव अध्ययनाधीन हैं।`;
        }
      }

      const ascText = analysisBasic.textContent.split("\n").find(l => l.startsWith("उदय राशि"));
      textLines.push(ascText.replace("उदय राशि (Ascendant):", "उदय राशि:"));

      const planetLines = analysisBasic.textContent.split("\n").filter(l => l.startsWith("•"));
      planetLines.forEach(planetLine => {
        const [pname, plong] = planetLine.replace("• ", "").split(":");
        const plon = parseFloat(plong);
        if (!isNaN(plon))
          textLines.push(`- ${planetSignEffect(pname.trim(), plon)}`);
        else
          textLines.push(`- ${pname.trim()} ग्रह की स्थिति उपलब्ध नहीं।`);
      });

      textLines.push("\nयह विवरण मुख्य ग्रहों और उदय राशि के आधार पर प्रारंभिक संकेत प्रदान करता है।");
      textLines.push("अधिक विस्तृत ज्योतिषीय ज्ञान के लिए विशेषज्ञ ज्योतिषी से सम्पर्क करें।");

      analysisDetailed.textContent = textLines.join("\n");
      analysisDetailed.style.display = "block";
      btnAnalysis.style.display = "none";
      setTimeout(() => {
        analysisDetailed.scrollIntoView({ behavior: "smooth" });
      }, 80);
    });

    // City lat,lng auto fill for Traditional Kundli form
    const tradCitySelect = document.getElementById("tradCity");
    const tradLatInput = document.getElementById("tradLat");
    const tradLngInput = document.getElementById("tradLng");
    tradCitySelect.addEventListener("change", e => {
      const val = e.target.value;
      if (val) {
        const [lat, lng] = val.split(",");
        tradLatInput.value = lat;
        tradLngInput.value = lng;
      }
    });

    // Traditional Kundli calculation and rendering (basic North Indian style with accurate houses)
    const tradForm = document.getElementById("tradForm");
    const tradChartContainer = document.getElementById("trad-chart-container");

    tradForm.addEventListener("submit", e => {
      e.preventDefault();

      const dob = tradForm.tradDob.value;
      const tob = tradForm.tradTob.value;
      const lat = parseFloat(tradForm.tradLat.value);
      const lng = parseFloat(tradForm.tradLng.value);

      if (!dob || !tob || isNaN(lat) || isNaN(lng)) {
        alert("कृपया सही जन्म विवरण भरें।");
        return;
      }

      // Calculate Julian Day
      const [hour, minute] = tob.split(":").map(Number);
      const [year, month, day] = dob.split("-").map(Number);
      const JD = Astronomy.toJulianDay(year, month, day, hour, minute);

      // Calculate Ascendant and house cusps for traditional kundli
      const asc = (function (JD, lat, lon) {
        const eps = 23.4397;
        let GST = Astronomy.greenwichSiderealTime(JD);
        let LST = (GST + lon) % 360;
        if (LST < 0) LST += 360;
        const radLat = Astronomy.degToRad(lat);
        const radEps = Astronomy.degToRad(eps);
        const radLST = Astronomy.degToRad(LST);
        let asc = Math.atan2(-Math.cos(radLST), Math.sin(radLST) * Math.cos(radEps) - Math.tan(radLat) * Math.sin(radEps));
        if (asc < 0) asc += 2 * Math.PI;
        return Astronomy.radToDeg(asc);
      })(JD, lat, lng);

      // Planetary longitudes
      const planets = calculatePlanets(JD);

      // Houses assignment code for traditional kundli
      // Basic North Indian style houses: Asc = house 1 on top vertical
      // Allocate planets to houses based on difference between planet longitude and ascendant
      // and using the 12 equal division houses
      let houses = Array.from({ length: 12 }, () => []);
      planets.forEach(planet => {
        let diff = planet.longitude - asc;
        if (diff < 0) diff += 360;
        let houseNum = Math.floor(diff / 30);
        houses[houseNum].push(planet.name);
      });

      renderTraditionalKundli(houses);
    });

    function renderTraditionalKundli(houses) {
      // North Indian Kundli grid 4x3 diamond style with planets in houses
      const houseTexts = ["1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12"];
      tradChartContainer.innerHTML = "";

      const container = document.createElement("div");
      container.style.position = "relative";
      container.style.width = "600px";
      container.style.height = "600px";
      container.style.margin = "auto";

      // Draw outer square diamond shape using SVG for effect
      const svgNS = "http://www.w3.org/2000/svg";
      const svg = document.createElementNS(svgNS, "svg");
      svg.setAttribute("width", "600");
      svg.setAttribute("height", "600");
      svg.style.position = "absolute";
      svg.style.top = 0;
      svg.style.left = 0;
      svg.style.zIndex = 1;

      const diamondPoints = "300,20 580,300 300,580 20,300";
      const diamond = document.createElementNS(svgNS, "polygon");
      diamond.setAttribute("points", diamondPoints);
      diamond.setAttribute("stroke", "#ffa832");
      diamond.setAttribute("stroke-width", "5");
      diamond.setAttribute("fill", "none");
      diamond.setAttribute("filter", "drop-shadow(0 0 12px #ffa832cc)");
      svg.appendChild(diamond);

      container.appendChild(svg);

      // Houses positions roughly (same as chart)
      const houseCenters = [
        [300, 125], [420, 195], [455, 335], [420, 465],
        [300, 525], [180, 460], [145, 325], [180, 190],
        [300, 300], [360, 230], [300, 180], [240, 230]
      ];

      // For each house box
      houses.forEach((planetArray, index) => {
        const houseDiv = document.createElement("div");
        houseDiv.style.position = "absolute";
        houseDiv.style.left = `${houseCenters[index][0] - 70}px`;
        houseDiv.style.top = `${houseCenters[index][1] - 60}px`;
        houseDiv.style.width = "140px";
        houseDiv.style.height = "100px";
        houseDiv.style.border = "2px solid #ffb14f";
        houseDiv.style.borderRadius = "20px";
        houseDiv.style.background = "rgba(255,168,50,0.15)";
        houseDiv.style.color = "#ffc973";
        houseDiv.style.fontWeight = "700";
        houseDiv.style.fontSize = "20px";
        houseDiv.style.textAlign = "center";
        houseDiv.style.paddingTop = "8px";
        houseDiv.style.textShadow = "0 0 6px #ffa833cc";
        houseDiv.style.userSelect = "none";

        // House number top
        let houseNumText = document.createElement("div");
        houseNumText.textContent = `घर ${houseTexts[index]}`;
        houseNumText.style.fontSize = "18px";
        houseNumText.style.fontWeight = "800";
        houseNumText.style.marginBottom = "6px";
        houseNumText.style.color = "#ff9d30";
        houseNumText.style.textShadow = "0 0 8px #cc7f2d";
        houseDiv.appendChild(houseNumText);

        // List planets line by line
        if (planetArray.length === 0) {
          const emptyMsg = document.createElement("div");
          emptyMsg.textContent = "कोई ग्रह नहीं";
          emptyMsg.style.fontSize = "16px";
          emptyMsg.style.color = "#ffa65b";
          houseDiv.appendChild(emptyMsg);
        } else {
          planetArray.forEach(pn => {
            const pText = document.createElement("div");
            pText.textContent = pn;
            pText.style.fontSize = "18px";
            pText.style.color = "#ffe3a3";
            pText.style.marginTop = "2px";
            houseDiv.appendChild(pText);
          });
        }
        container.appendChild(houseDiv);
      });

      tradChartContainer.appendChild(container);
    }


    /* === Numerology Section === */
    const numForm = document.getElementById("numForm");
    const numAnalysis = document.getElementById("num-analysis");

    numForm.addEventListener("submit", e => {
      e.preventDefault();
      const name = numForm.numName.value.trim().toLowerCase();
      const dob = numForm.numDob.value;
      if (!name || !dob) {
        alert("कृपया नाम और जन्मतिथि दर्ज करें।");
        return;
      }

      let text = "🔢 Your Numerology Report 🔢\n\n";

      // Life Path Number from DOB
      const digits = dob.replace(/\D/g, "").split("");
      const lifeNumber = sumToSingleDigit(digits.map(d => parseInt(d)));
      text += `Your Life Path Number is: ${lifeNumber}\n`;
      text += numerologyMeaning(lifeNumber) + "\n\n";

      // Expression Number from name letters
      const chars = name.replace(/[^a-z]/g, "");
      const charNums = chars.split("").map(c => letterToNumber(c));
      const expressionNumber = sumToSingleDigit(charNums);
      text += `Your Expression Number is: ${expressionNumber}\n`;
      text += numerologyMeaning(expressionNumber) + "\n\n";

      text += "Numerology gives insights into your personality and life journey.\n";
      numAnalysis.textContent = text;
    });

    function sumToSingleDigit(numbers) {
      let total = numbers.reduce((a, b) => a + b, 0);
      while (total > 9 && total !== 11 && total !== 22) {
        total = total.toString().split("").reduce((a, b) => a + parseInt(b), 0);
      }
      return total;
    }

    function letterToNumber(char) {
      // Map a=1,b=2,...i=9,j=1,......
      const map = {
        a: 1, b: 2, c: 3, d: 4, e: 5, f: 6, g: 7, h: 8, i: 9,
        j: 1, k: 2, l: 3, m: 4, n: 5, o: 6, p: 7, q: 8, r: 9,
        s: 1, t: 2, u: 3, v: 4, w: 5, x: 6, y: 7, z: 8
      };
      return map[char] || 0;
    }

    function numerologyMeaning(num) {
      switch (num) {
        case 1: return "प्रस्तावित: नेतृत्व, स्वतंत्रता, आत्मनिर्भरता।";
        case 2: return "प्रस्तावित: सहयोग, संतुलन, संवेदनशीलता।";
        case 3: return "प्रस्तावित: रचनात्मकता, संचार, आनंद।";
        case 4: return "प्रस्तावित: मेहनत, अनुशासन, विश्वसनीयता।";
        case 5: return "प्रस्तावित: स्वतंत्रता, उत्साह, रोमांच।";
        case 6: return "प्रस्तावित: जिम्मेदारी, करुणा, परिवार।";
        case 7: return "प्रस्तावित: आध्यात्मिकता, चिंतन, खोज।";
        case 8: return "प्रस्तावित: शक्ति, प्रबंधन, करियर।";
        case 9: return "प्रस्तावित: दयालुता, मानवता, परोपकार।";
        case 11: return "महासंकल्पित: स्वप्नदृष्टा, प्रेरक, प्रकाश।";
        case 22: return "महासंकल्पित: बड़े कार्यकर्ता, निर्माता, नेता।";
        default: return "विशेष संख्या के लिए और अध्ययन आवश्यक है।";
      }
    }

    /* === Vimshottari Dasha (Simplified) === */
    const dashaForm = document.getElementById("dashaForm");
    const dashaResult = document.getElementById("dasha-result");

    dashaForm.addEventListener("submit", e => {
      e.preventDefault();

      const dob = dashaForm.dashaDob.value;
      const tob = dashaForm.dashaTob.value;
      if (!dob || !tob) {
        alert("कृपया जन्म की तिथि और समय सही से भरें।");
        return;
      }

      const [year, month, day] = dob.split("-").map(Number);
      const [hour, minute] = tob.split(":").map(Number);
      const JD = Astronomy.toJulianDay(year, month, day, hour, minute);

      // Simplified Moon longitude-based Dasha calculation
      const moonLon = Astronomy.moonLongitude(JD);
      const nakshatraNum = Math.floor(moonLon / (360 / 27)); // 1 to 27 nakshatras

      const dashaList = [
        { name: "Ketu", duration: 7 },
        { name: "Shani", duration: 19 },
        { name: "Budh", duration: 17 },
        { name: "Guru", duration: 16 },
        { name: "Shukra", duration: 20 },
        { name: "Surya", duration: 6 },
        { name: "Chandra", duration: 10 },
        { name: "Mangal", duration: 7 },
        { name: "Rahu", duration: 18 }
      ];

      let startIndex = nakshatraNum % 9;
      let resultText = `🌟 Vimshottari Dasha प्रारंभिक स्थिति 🌟\n\nजन्म नक्षत्र संख्या: ${nakshatraNum + 1}\n\n`;
      resultText += "डशा क्रम और अवधि (वर्षों में):\n";

      for (let i = 0; i < 9; i++) {
        let idx = (startIndex + i) % 9;
        const dasha = dashaList[idx];
        resultText += `- ${dasha.name}: ${dasha.duration} वर्ष\n`;
      }
      resultText +=
        "\nयह एक सरलीकृत डशा गणना है। अधिक सटीक परिणामों के लिए विस्तृत ज्योतिषीय गणनाएं आवश्यक हैं।";

      dashaResult.textContent = resultText;
    });

  </script>
</body>

</html>
