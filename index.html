<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Divine Kundli Astrology Calculator</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;600&display=swap');
  /* -- Basic body and container styles -- */
  body {
    margin: 0;
    background: #0e1127;
    font-family: 'Poppins', sans-serif;
    color: #eee;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
    padding: 25px 15px;
    user-select: none;
  }
  header h1 {
    font-size: 2.4rem;
    font-weight: 600;
    margin-bottom: 6px;
    color: #24e1da;
    text-shadow: 0 0 12px #00ffe8bb;
    text-align:center;
  }
  header p {
    font-weight: 400;
    color: #a6e6e3cc;
    font-size: 1rem;
    margin-bottom: 25px;
    text-align:center;
  }
  form {
    background: #162040cc;
    border-radius: 18px;
    width: 100%;
    max-width: 480px;
    padding: 25px 30px;
    box-shadow: 0 0 40px #14c3c7aa;
    transition: box-shadow 0.3s ease;
  }
  form:hover {
    box-shadow: 0 0 70px #30d7deff;
  }
  label {
    font-weight: 600;
    font-size: 0.94rem;
    color: #0ff5ff;
    display: block;
  }
  input, select {
    margin: 8px 0 18px 0;
    border-radius: 14px;
    border: none;
    padding: 11px 14px;
    font-size: 1rem;
    font-family: 'Poppins', sans-serif;
    background: #0a0f1f;
    color: #eee;
    box-shadow: inset 0 0 8px #00d8dcaa;
    transition: box-shadow 0.3s ease;
  }
  input:focus, select:focus {
    outline: none;
    box-shadow: 0 0 18px #00e8fddd;
    background: #001e27;
    color: #b3ffff;
  }
  button {
    width: 100%;
    padding: 14px 0;
    border-radius: 20px;
    background: linear-gradient(45deg, #00f2ff, #00bfff);
    color: #005962cc;
    font-weight: 800;
    font-size: 1.18rem;
    letter-spacing: 1.5px;
    border: none;
    cursor: pointer;
    box-shadow: 0 0 12px #00f0ffff;
    transition: all 0.3s ease;
    user-select: none;
  }
  button:hover {
    background: linear-gradient(45deg, #00e8ff, #00ffff);
    color: #00353f;
    box-shadow: 0 0 25px #0ff6ffff;
  }
  main {
    width: 100%;
    max-width: 900px;
    margin-top: 35px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  #chart-container {
    width: 100%;
    background:#161a3eee;
    border-radius: 24px;
    box-shadow: 0 0 30px #008caa99;
    padding: 30px 30px 40px 30px;
    margin-bottom: 10px;
    position: relative;
  }
  svg {
    width: 100%;
    height: auto;
  }
  .house-label {
    fill: #15fff9cc;
    font-weight: 700;
    font-size: 18px;
    user-select: none;
    text-shadow: 0 0 7px #04b0b8bb;
  }
  .planet-text {
    fill: #ff487eee;
    font-weight: 700;
    font-size: 16px;
    text-shadow: 0 0 8px #ff487ea0;
    pointer-events: none;
    user-select: none;
  }
  .planet-circle {
    fill: #ff477e;
    stroke: #fff;
    stroke-width: 2;
    cursor: pointer;
    filter: drop-shadow(0 0 6px #ff487ebb);
    transform-origin: center;
    transition: all 0.5s ease;
    animation: orbit-pulse 3.5s ease-in-out infinite;
  }
  .planet-circle:hover {
    fill: #fff;
    filter: drop-shadow(0 0 15px #ff88aad4);
    transform: scale(1.3);
  }
  @keyframes orbit-pulse {
    0%   { filter: drop-shadow(0 0 6px #ff477eee); }
    50%  { filter: drop-shadow(0 0 18px #ff668aaa); }
    100% { filter: drop-shadow(0 0 6px #ff477eee); }
  }
  #analysis, #analysis-detailed {
    width: 100%;
    max-width: 900px;
    background: #0e152b;
    color: #87dede;
    padding: 25px 30px;
    border-radius: 18px;
    font-family: 'Poppins', sans-serif;
    font-size: 1rem;
    line-height: 1.5;
    white-space: pre-line;
    box-shadow: 0 0 20px #00e8fddd;
    margin-bottom: 32px;
  }
  #btnAnalysis {
    background: #00f6ffbb;
    border: none;
    padding: 14px 28px;
    border-radius: 50px;
    font-weight: 700;
    font-size: 1.04rem;
    cursor: pointer;
    box-shadow: 0 0 30px #00c4d4cc;
    color: #00353f;
    transition: background-color 0.3s ease;
    margin-bottom: 22px;
  }
  #btnAnalysis:hover {
    background: #00d8f7;
  }
  /* Responsive */
  @media (max-width: 700px) {
    main {
      max-width: 100%;
    }
    form {
      max-width: 100%;
      padding: 20px;
    }
  }
</style>
</head>
<body>
<header>
  <h1>Divine Kundli Astrology Calculator</h1>
  <p>Exact birth details se advanced animated kundli chart aur detailed explanation payen</p>
</header>

<form id="kundliForm" autocomplete="off">
  <label for="dob">Date of Birth</label>
  <input type="date" id="dob" required />

  <label for="tob">Time of Birth (24h format)</label>
  <input type="time" id="tob" required step="60" value="12:00" />

  <label for="city">Select City (Auto-fill Latitude & Longitude)</label>
  <select id="city">
    <option value="">-- Select City --</option>
    <option value="22.5726,88.3639">Kolkata</option>
    <option value="23.9941,85.3636">Hazaribagh</option>
    <option value="23.3441,85.3096">Ranchi</option>
    <option value="28.6139,77.2090">Delhi</option>
    <option value="19.0760,72.8777">Mumbai</option>
    <option value="12.9716,77.5946">Bengaluru</option>
  </select>

  <label for="lat">Latitude</label>
  <input type="number" id="lat" placeholder="Latitude" step="0.0001" required />

  <label for="lng">Longitude</label>
  <input type="number" id="lng" placeholder="Longitude" step="0.0001" required />

  <button id="btnGenerate">Generate Kundli & Chart</button>
</form>

<main>
  <section id="chart-container" aria-label="Kundli Chart"></section>

  <button id="btnAnalysis" style="display:none;">Show Detailed Analysis</button>

  <section id="analysis" aria-live="polite" aria-label="Basic Kundli Summary"></section>

  <section id="analysis-detailed" style="display:none;" aria-live="polite" aria-label="Detailed Kundli Analysis"></section>
</main>

<script>
  // Update lat and lng fields if city selected
  const citySelect = document.getElementById("city");
  const latInput = document.getElementById("lat");
  const lngInput = document.getElementById("lng");
  citySelect.addEventListener("change", e => {
    const val = e.target.value;
    if(val) {
      const [lat,lng] = val.split(",");
      latInput.value = lat;
      lngInput.value = lng;
    }
  });

  // Astronomy utility class with precise approximate formulas
  class Astronomy {
    static toJulianDay(year, month, day, hour, minute) {
      if(month <= 2) {
        year -= 1;
        month += 12;
      }
      const A = Math.floor(year/100),
            B = 2 - A + Math.floor(A/4),
            dayFraction = (hour + minute/60)/24;
      return Math.floor(365.25*(year + 4716)) + Math.floor(30.6001*(month + 1)) + day + dayFraction + B - 1524.5;
    }
    static degToRad(d) { return d * Math.PI / 180; }
    static radToDeg(r) { return r * 180 / Math.PI; }

    static sunLongitude(JD) {
      const n = JD - 2451545.0;
      const L = (280.460 + 0.9856474 * n) % 360;
      const g = (357.528 + 0.9856003 * n) % 360;
      const gRad = this.degToRad(g);
      let lambda = L + 1.915 * Math.sin(gRad) + 0.020 * Math.sin(2 * gRad);
      return (lambda + 360) % 360;
    }
    static moonLongitude(JD) {
      const n = JD - 2451550.1;
      const L = (218.316 + 13.176396 * n) % 360;
      const M = (134.963 + 13.064993 * n) % 360;
      const F = (93.272 + 13.229350 * n) % 360;
      const LRad = this.degToRad(L);
      const MRad = this.degToRad(M);
      const FRad = this.degToRad(F);

      let lambda = L + 6.289 * Math.sin(MRad) - 3.0 * Math.sin(LRad - this.degToRad(297.850)) + 1.274 * Math.sin(2 * this.degToRad(L) - MRad)
        + 0.658 * Math.sin(2 * LRad) + 0.214 * Math.sin(2 * MRad) - 0.186 * Math.sin(this.degToRad(297.850)) + 0.114 * Math.sin(2 * FRad);
      return (lambda + 360) % 360;
    }
    static mercuryLongitude(JD) {
      const n = JD - 2451545.0;
      let L = (252.25084 + 4.0923344368 * n) % 360;
      return (L + 360) % 360;
    }
    static venusLongitude(JD) {
      const n = JD - 2451545.0;
      let L = (181.9798 + 1.6021302244 * n) % 360;
      return (L + 360) % 360;
    }
    static marsLongitude(JD) {
      const n = JD - 2451545.0;
      let L = (355.433 + 0.5240207766 * n) % 360;
      return (L + 360) % 360;
    }
    static jupiterLongitude(JD) {
      const n = JD - 2451545.0;
      let L = (34.3515 + 0.083091 * n) % 360;
      return (L + 360) % 360;
    }
    static saturnLongitude(JD) {
      const n = JD - 2451545.0;
      let L = (50.07745 + 0.0300657 * n) % 360;
      return (L + 360) % 360;
    }
    static greenwichSiderealTime(JD) {
      const JD0 = Math.floor(JD + 0.5) - 0.5;
      const S = JD0 - 2451545.0;
      const T = S / 36525.0;
      const T0 = 6.697374558 + 2400.051336 * T + 0.000025862 * T * T;
      const UT = (JD - JD0) * 24;
      let GST = T0 + UT * 1.002737909;
      GST = (GST % 24) * 15; // Convert hours to degrees
      if (GST < 0) GST += 360;
      return GST;
    }
  }

  const signs = ["मेष", "वृषभ", "मिथुन", "कर्क", "सिंह", "कन्या", "तुला", "वृश्चिक", "धनु", "मकर", "कुम्भ", "मीन"];
  
  function formatLongitude(lon) {
    let normLon = lon % 360;
    if (normLon < 0) normLon += 360;
    const signIndex = Math.floor(normLon / 30);
    const degreeSign = normLon % 30;
    return `${degreeSign.toFixed(2)}° ${signs[signIndex]}`;
  }

  function drawChart(planets, asc, container) {
    const svgNS = "http://www.w3.org/2000/svg";
    container.innerHTML = "";
    const size = Math.min(600, window.innerWidth - 40);
    const svg = document.createElementNS(svgNS, "svg");
    svg.setAttribute("width", size);
    svg.setAttribute("height", size);
    svg.setAttribute("viewBox", "0 0 600 600");
    svg.style.maxWidth = "100%";
    container.appendChild(svg);
    // Diamond diamond shape for houses
    const pts = "300,20 580,300 300,580 20,300";
    const diamond = document.createElementNS(svgNS, "polygon");
    diamond.setAttribute("points", pts);
    diamond.setAttribute("stroke", "#00fff7");
    diamond.setAttribute("stroke-width", "5");
    diamond.setAttribute("fill", "none");
    diamond.setAttribute("filter", "drop-shadow(0 0 6px #00fff7cc)");
    svg.appendChild(diamond);
    // House lines
    const lines = [
      [20, 300, 300, 580],
      [300, 580, 580, 300],
      [580, 300, 300, 20],
      [300, 20, 20, 300]
    ];
    lines.forEach(([x1,y1,x2,y2]) => {
      const line = document.createElementNS(svgNS, "line");
      line.setAttribute("x1", x1);
      line.setAttribute("y1", y1);
      line.setAttribute("x2", x2);
      line.setAttribute("y2", y2);
      line.setAttribute("stroke", "#00fff7");
      line.setAttribute("stroke-width", "3");
      svg.appendChild(line);
    });
    // House number locations
    const houseCenters = [
      [300,125],[420,195],[455,335],[420,465],[300,525],[180,460],
      [145,325],[180,190],[300,300],[360,230],[300,180],[240,230]
    ];
    const ascSignIndex = Math.floor(asc / 30);
    for(let i=0;i<12;i++){
      const houseNum = ((ascSignIndex + i) % 12) + 1;
      const [x,y]= houseCenters[i];
      const text = document.createElementNS(svgNS,"text");
      text.setAttribute("x",x);
      text.setAttribute("y",y-20);
      text.setAttribute("fill","#00fff7");
      text.setAttribute("font-size","18");
      text.setAttribute("font-weight","700");
      text.setAttribute("text-anchor","middle");
      text.textContent = houseNum;
      svg.appendChild(text);
    }
    // Planet positions
    const cx = 300, cy = 300, radius = 230;
    planets.forEach(({name, longitude})=>{
      const relAngle = (longitude - asc + 360) % 360;
      const angleRad = (relAngle - 90) * Math.PI/180;
      const px = cx + radius * Math.cos(angleRad);
      const py = cy + radius * Math.sin(angleRad);
      const circle = document.createElementNS(svgNS,"circle");
      circle.setAttribute("cx",px);
      circle.setAttribute("cy",py);
      circle.setAttribute("r",18);
      circle.setAttribute("class","planet-circle");
      circle.setAttribute("title", `${name}: ${formatLongitude(longitude)}`);
      svg.appendChild(circle);
      const text = document.createElementNS(svgNS,"text");
      text.setAttribute("x", px);
      text.setAttribute("y", py + 37);
      text.setAttribute("fill","#ff467e");
      text.setAttribute("font-weight","700");
      text.setAttribute("font-size","15");
      text.setAttribute("text-anchor","middle");
      text.style.userSelect = "none";
      text.textContent = name;
      svg.appendChild(text);
    });
  }

  function calculatePlanets(jd) {
    return [
      { name: "Surya", longitude: Astronomy.sunLongitude(jd) },
      { name: "Chandra", longitude: Astronomy.moonLongitude(jd) },
      { name: "Budh", longitude: Astronomy.mercuryLongitude(jd) },
      { name: "Shukra", longitude: Astronomy.venusLongitude(jd) },
      { name: "Mangal", longitude: Astronomy.marsLongitude(jd) },
      { name: "Guru", longitude: Astronomy.jupiterLongitude(jd) },
      { name: "Shani", longitude: Astronomy.saturnLongitude(jd) }
    ];
  }

  const form = document.getElementById("kundliForm");
  const chartContainer = document.getElementById("chart-container");
  const analysisBasic = document.getElementById("analysis");
  const btnAnalysis = document.getElementById("btnAnalysis");
  const analysisDetailed = document.getElementById("analysis-detailed");

  form.addEventListener("submit", e => {
    e.preventDefault();

    const dob = form.dob.value;
    const tob = form.tob.value;
    const lat = parseFloat(form.lat.value);
    const lng = parseFloat(form.lng.value);
    if(!dob || !tob || isNaN(lat) || isNaN(lng)){
      alert("कृपया सारी जानकारियां सही भरें।");
      return;
    }

    const [hour, minute] = tob.split(":").map(Number);
    const [year, month, day] = dob.split("-").map(Number);

    const jd = Astronomy.toJulianDay(year, month, day, hour, minute);
    const planets = calculatePlanets(jd);

    const ascendant = (function(jd, lat, lon){
      const eps = 23.4397;
      let GST = Astronomy.greenwichSiderealTime(jd);
      let LST = (GST + lon) % 360;
      if(LST < 0) LST += 360;
      const radLat = Astronomy.degToRad(lat);
      const radEps = Astronomy.degToRad(eps);
      const radLST = Astronomy.degToRad(LST);
      let asc = Math.atan2(-Math.cos(radLST), Math.sin(radLST)*Math.cos(radEps)-Math.tan(radLat)*Math.sin(radEps));
      if(asc < 0) asc += 2*Math.PI;
      return Astronomy.radToDeg(asc);
    })(jd, lat, lng);

    drawChart(planets, ascendant, chartContainer);

    // Basic summary
    analysisBasic.textContent = `आपका जन्म विवरण:\n- तिथि: ${dob}\n- समय: ${tob}\n- अक्षांश: ${lat.toFixed(4)}\n- देशांतर: ${lng.toFixed(4)}\n\n` +
      `उदय राशि (Ascendant): ${formatLongitude(ascendant)}\n\n` +
      `ग्राहों की स्थिति:\n` + planets.map(p => `• ${p.name}: ${formatLongitude(p.longitude)}`).join("\n");

    // Show analysis button and clear detailed on new generate
    btnAnalysis.style.display = "block";
    analysisDetailed.style.display = "none";
    analysisDetailed.textContent = "";
  });

  btnAnalysis.addEventListener("click", () => {
    // Construct detailed natural language analysis
    let textLines = [];
    textLines.push("✨ विस्तृत kundli विश्लेषण ✨\n");
    textLines.push(analysisBasic.textContent);
    textLines.push("\nग्रहों का प्रभाव और संकेत:");
    
    // Example brief interpretation with sample rules, encourage deep customizations
    function planetSignEffect(name, lon){
      let signIndex = Math.floor(lon/30);
      let sign = signs[signIndex];
      switch(name){
        case "Surya": 
          return `सूर्य ${sign} राशि में होता है, जिससे नेतृत्व क्षमता और आत्मविश्वास बढ़ते हैं।`;
        case "Chandra": 
          return `चन्द्र ${sign} राशि में है, इसका प्रभाव भावनाओं और मानसिक स्थिति पर पड़ता है।`;
        case "Budh": 
          return `बुध ${sign} राशि में है, जिससे बुद्धि और संवाद कौशल प्रभावित होते हैं।`;
        case "Shukra": 
          return `शुक्र ${sign} राशि में है, जो प्रेम, सौंदर्य और सामाजिक संबंधों पर प्रभाव डालता है।`;
        case "Mangal": 
          return `मंगल ${sign} राशि में है, जो ऊर्जा और साहस को दर्शाता है।`;
        case "Guru": 
          return `गुरु ${sign} राशि में है, जो ज्ञान और आध्यात्मिकता से जुड़ा है।`;
        case "Shani": 
          return `शनि ${sign} राशि में होता है, अड़चनों एवं अनुशासन के कारक के रूप में जाना जाता है।`;
        default: 
          return `${name} ग्रह के प्रभाव अध्ययनाधीन हैं।`;
      }
    }

    // Retrieve planets and asc info from last generate
    const ascText = analysisBasic.textContent.split("\n").find(l => l.startsWith("उदय राशि"));
    textLines.push(ascText.replace("उदय राशि (Ascendant):", "उदय राशि:"));

    // planets line parsing
    const planetLines = analysisBasic.textContent.split("\n").filter(l=>l.startsWith("•"));
    planetLines.forEach(planetLine => {
      const [pname, plong] = planetLine.replace("• ","").split(":");
      const plon = parseFloat(plong);
      if(!isNaN(plon))
        textLines.push(`- ${planetSignEffect(pname.trim(), plon)}`);
      else
        textLines.push(`- ${pname.trim()} ग्रह की स्थिति उपलब्ध नहीं।`);
    });

    textLines.push("\nयह विवरण मुख्य ग्रहों और उदय राशि के आधार पर प्रारंभिक संकेत प्रदान करता है।");
    textLines.push("अधिक विस्तृत ज्योतिषीय ज्ञान के लिए विशेषज्ञ ज्योतिषी से सम्पर्क करें।");

    analysisDetailed.textContent = textLines.join("\n");
    analysisDetailed.style.display = "block";
    btnAnalysis.style.display = "none";
    // Smooth scroll detailed section form ke niche visible ho
    setTimeout(() => {
      analysisDetailed.scrollIntoView({behavior:"smooth"});
    }, 80);
  });
</script>
</body>
</html>
