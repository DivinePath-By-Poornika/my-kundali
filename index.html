<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kundli Generator ‚Äì API‚Äëfree (Hindi, High Precision Ready)</title>
  <style>
    :root{--bg:#0f1320;--card:#141a2f;--ink:#e8ecff;--muted:#9aa5d1;--accent:#6ee7ff;--good:#7ef7a6;--warn:#ffd66e;--danger:#ff7e7e}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial;background:radial-gradient(1200px 800px at 80% -20%,#20305A33 0%,transparent 60%),var(--bg);color:var(--ink)}
    header{padding:24px 16px 8px;display:flex;gap:10px;align-items:center;justify-content:space-between}
    h1{margin:0;font-weight:800;letter-spacing:.3px;font-size:clamp(20px,3vw,28px)}
    .wrap{display:grid;grid-template-columns:420px 1fr;gap:16px;padding:16px}
    @media (max-width:1100px){.wrap{grid-template-columns:1fr;}}
    .card{background:linear-gradient(180deg,#161d39 0%, #101429 100%);border:1px solid #2a335f;border-radius:16px;box-shadow:0 10px 30px #0007}
    .panel{padding:16px}
    .panel h2{margin:0 0 8px;font-size:16px;font-weight:700;color:#cfe1ff}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    label{display:block;font-size:12px;color:var(--muted);margin:8px 0 6px}
    input,select,button,textarea{width:100%;padding:10px 12px;border-radius:10px;border:1px solid #2a335f;background:#0e1330;color:var(--ink);outline:none}
    input:focus,select:focus,textarea:focus{border-color:#5fa8ff;box-shadow:0 0 0 3px #5fa8ff30}
    .row{display:flex;gap:10px}
    .row > *{flex:1}
    .btn{cursor:pointer;border:1px solid #3156a3;background:linear-gradient(180deg,#23408e,#1a2f6c);font-weight:700}
    .btn:active{transform:translateY(1px)}
    .btn.ghost{background:#0e1330}
    .muted{color:var(--muted);font-size:12px}
    .chips{display:flex;flex-wrap:wrap;gap:6px;margin-top:8px}
    .chip{font-size:12px;border:1px dashed #3850a8;border-radius:999px;padding:6px 10px;color:#cfe1ff}
    canvas,svg{max-width:100%;height:auto}
    .stack{display:grid;gap:12px}
    table{width:100%;border-collapse:collapse}
    th,td{padding:6px 8px;border-bottom:1px dashed #334}
    th{font-size:12px;color:#bcd}
    td{font-size:13px;color:#eaf}
    .foot{display:flex;gap:10px;flex-wrap:wrap}
    .badge{font:12px/1.2 ui-monospace,monospace;background:#0c1130;border:1px solid #384074;border-radius:8px;padding:8px 10px;color:#bcd}
    .ok{color:var(--good)} .warn{color:var(--warn)}
    .pill{display:inline-flex;gap:8px;align-items:center;border:1px solid #3b4a95;background:#0c1233;border-radius:999px;padding:8px 12px;font-size:12px}
    .section{display:grid;gap:8px}
    textarea{min-height:180px;resize:vertical}
  </style>
</head>
<body>
  <header>
    <h1>üî≠ Kundli Generator ‚Äî Hindi (No API)</h1>
    <div class="chips">
      <div class="chip">Sidereal (Lahiri)</div>
      <div class="chip">Equal Houses</div>
      <div class="chip">North‚ÄëIndian Chart</div>
      <div class="chip" id="precTag">Precision: Standard</div>
    </div>
  </header>

  <main class="wrap">
    <section class="card panel">
      <h2>‡§ú‡§®‡•ç‡§Æ ‡§µ‡§ø‡§µ‡§∞‡§£</h2>
      <div class="grid">
        <div>
          <label>‡§®‡§æ‡§Æ</label>
          <input id="name" placeholder="‡§â‡§¶‡§æ., Priyanshu" />
        </div>
        <div>
          <label>‡§ú‡§®‡•ç‡§Æ ‡§§‡§ø‡§•‡§ø</label>
          <input id="dob" type="date" />
        </div>
        <div>
          <label>‡§ú‡§®‡•ç‡§Æ ‡§∏‡§Æ‡§Ø</label>
          <input id="tob" type="time" step="1" />
        </div>
        <div>
          <label>‡§∏‡§Æ‡§Ø ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞ (UTC ‡§ë‡§´‡§º‡§∏‡•á‡§ü, ‡§ò‡§Ç‡§ü‡•á)</label>
          <input id="tz" type="number" step="0.25" value="5.5" />
        </div>
        <div>
          <label>‡§°‡•á‚Äë‡§≤‡§æ‡§á‡§ü ‡§∏‡•á‡§µ‡§ø‡§Ç‡§ó</label>
          <select id="dst">
            <option value="0">‡§®‡§π‡•Ä‡§Ç</option>
            <option value="1">‡§π‡§æ‡§Å (+1h)</option>
          </select>
        </div>
        <div>
          <label>‡§Ö‡§ï‡•ç‡§∑‡§æ‡§Ç‡§∂ (Latitude, +‡§â‡§§‡•ç‡§§‡§∞)</label>
          <input id="lat" type="number" step="0.0001" placeholder="28.6139" />
        </div>
        <div>
          <label>‡§¶‡•á‡§∂‡§æ‡§Ç‡§§‡§∞ (Longitude, +‡§™‡•Ç‡§∞‡•ç‡§µ)</label>
          <input id="lon" type="number" step="0.0001" placeholder="77.2090" />
        </div>
      </div>

      <div class="row" style="margin-top:12px">
        <button class="btn" id="calc">‡§ï‡•Å‡§Ç‡§°‡§≤‡•Ä ‡§¨‡§®‡§æ‡§è‡§Ç</button>
        <button class="btn ghost" id="example">‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‡§≠‡§∞‡•á‡§Ç (‡§¶‡§ø‡§≤‡•ç‡§≤‡•Ä)</button>
      </div>

      <div class="row" style="margin-top:8px">
        <button class="btn" id="dlPng">PNG ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§°</button>
        <button class="btn" id="dlSvg">SVG ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§°</button>
        <button class="btn" id="dlTxt">‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü (TXT) ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§°</button>
      </div>

      <div class="section" style="margin-top:12px">
        <div class="pill" id="locStatus">
          <span>üìç <strong>‡§≤‡•ã‡§ï‡•á‡§∂‡§®:</strong> <em>Auto detect ‡§¨‡§Ç‡§¶</em></span>
        </div>
        <div class="row">
          <button class="btn" id="detectLoc">‡§Æ‡•á‡§∞‡•Ä ‡§≤‡•ã‡§ï‡•á‡§∂‡§® ‡§ë‡§ü‡•ã‚Äë‡§°‡§ø‡§ü‡•á‡§ï‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç</button>
          <button class="btn ghost" id="clearLoc">‡§ï‡•ç‡§≤‡§ø‡§Ø‡§∞</button>
        </div>
        <div class="pill">
          <input id="hiPrec" type="checkbox" />
          <span><strong>‡§π‡§æ‡§à‚Äë‡§™‡•ç‡§∞‡§ø‡§∏‡•Ä‡§ú‡§® ‡§Æ‡•ã‡§°</strong> (‡§Ø‡§¶‡§ø <code>/swe/</code> ‡§Æ‡•á‡§Ç Swiss Ephemeris WASM ‡§´‡§æ‡§á‡§≤‡•á‡§Ç ‡§∞‡§ñ‡•á‡§Ç, ‡§§‡•ã ‡§Ö‡§™‡§®‡•á‚Äë‡§Ü‡§™ ‡§á‡§∏‡•ç‡§§‡•á‡§Æ‡§æ‡§≤ ‡§π‡•ã‡§ó‡§æ)</span>
        </div>
        <p class="muted">‡§Ø‡§π ‡§ê‡§™ ‡§™‡•Ç‡§∞‡•Ä ‡§§‡§∞‡§π ‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º‡§∞ ‡§Æ‡•á‡§Ç ‡§ö‡§≤‡§§‡§æ ‡§π‡•à ‚Äî ‡§ï‡§ø‡§∏‡•Ä ‡§¨‡§æ‡§π‡§∞‡•Ä API ‡§ï‡•Ä ‡§ú‡§∞‡•Ç‡§∞‡§§ ‡§®‡§π‡•Ä‡§Ç‡•§ ‡§™‡•ç‡§∞‡•ã‚Äë‡§ó‡•ç‡§∞‡•á‡§° ‡§∂‡•Å‡§¶‡•ç‡§ß‡§§‡§æ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§µ‡•à‡§ï‡§≤‡•ç‡§™‡§ø‡§ï Swiss Ephemeris WASM ‡§ú‡•ã‡§°‡§º ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§</p>
      </div>
    </section>

    <section class="stack">
      <div class="card panel">
        <h2>North‚ÄëIndian Chart</h2>
        <div id="chartWrap" class="panel" style="background:#0c1130;border-radius:12px;border:1px solid #2a335f">
          <svg id="chart" viewBox="0 0 800 800" width="800" height="800" role="img" aria-label="Kundli Chart"></svg>
        </div>
        <div class="foot">
          <span class="badge" id="ayanamshaLbl">Ayanamsha: ‚Äî</span>
          <span class="badge" id="ascLbl">Asc: ‚Äî</span>
          <span class="badge" id="nakLbl">‡§ö‡§Ç‡§¶‡•ç‡§∞ ‡§®‡§ï‡•ç‡§∑‡§§‡•ç‡§∞: ‚Äî</span>
        </div>
      </div>

      <div class="card panel">
        <h2>‡§ó‡•ç‡§∞‡§π ‡§¶‡•á‡§∂‡§æ‡§Ç‡§§‡§∞ (‡§∏‡§æ‡§á‡§°‡§∞‡•Ä‡§Ø‡§≤ ‚Äì ‡§≤‡§π‡•Ä‡§∞‡•Ä)</h2>
        <table id="tbl"><thead><tr><th>‡§ó‡•ç‡§∞‡§π</th><th>‡§¶‡•á‡§∂‡§æ‡§Ç‡§§‡§∞</th><th>‡§∞‡§æ‡§∂‡§ø</th><th>‡§®‡§ï‡•ç‡§∑‡§§‡•ç‡§∞</th><th>‡§≠‡§æ‡§µ</th><th>‡§∏‡•ç‡§•‡§ø‡§§‡§ø</th></tr></thead><tbody></tbody></table>
        <p class="muted">Standard ‡§á‡§Ç‡§ú‡§® signs/houses ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡§æ‡§´‡•Ä ‡§∏‡§ü‡•Ä‡§ï ‡§π‡•à‡•§ ‡§π‡§æ‡§à‚Äë‡§™‡•ç‡§∞‡§ø‡§∏‡•Ä‡§ú‡§® ‡§Æ‡•ã‡§° ‡§ö‡§Ç‡§¶‡•ç‡§∞/‡§§‡•á‡§ú‡§º ‡§ó‡•ç‡§∞‡§π‡•ã‡§Ç ‡§ï‡•á ‡§¶‡•á‡§∂‡§æ‡§Ç‡§§‡§∞ ‡§î‡§∞ ‡§ü‡§æ‡§á‡§ü ‡§ï‡§∞‡§§‡§æ ‡§π‡•à (‡§Ø‡§¶‡§ø WASM ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§π‡•ã)‡•§</p>
      </div>

      <div class="card panel">
        <h2>‡§ò‡§∞‚Äë‡§µ‡§æ‡§∞ (Housewise) ‡§™‡•ç‡§≤‡•á‡§∏‡§Æ‡•á‡§Ç‡§ü</h2>
        <div id="houseList" class="section"></div>
      </div>

      <div class="card panel">
        <h2>‡§µ‡•ç‡§Ø‡§æ‡§ñ‡•ç‡§Ø‡§æ (Hindi)</h2>
        <button class="btn" id="makeInterpret">‡§è‡§ï‡•ç‡§∏‡§™‡•ç‡§≤‡•á‡§®‡•á‡§∂‡§® ‡§¨‡§®‡§æ‡§è‡§Ç</button>
        <textarea id="interpretBox" placeholder="‡§¨‡§ü‡§® ‡§¶‡§¨‡§æ‡§è‡§Å ‚Äî ‡§®‡•Ä‡§ö‡•á ‡§π‡§ø‡§®‡•ç‡§¶‡•Ä ‡§Æ‡•á‡§Ç ‡§µ‡§ø‡§∏‡•ç‡§§‡•É‡§§ ‡§™‡•à‡§∞‡§æ‡§ó‡•ç‡§∞‡§æ‡§´ ‡§ë‡§ü‡•ã‚Äë‡§ú‡§®‡§∞‡•á‡§ü ‡§π‡•ã‡§ó‡§æ, ‡§ú‡§ø‡§∏‡§Æ‡•á‡§Ç ‡§π‡§∞ ‡§ò‡§∞ ‡§Æ‡•á‡§Ç ‡§ï‡•å‡§®‚Äë‡§∏‡§æ ‡§ó‡•ç‡§∞‡§π ‡§π‡•à ‡§î‡§∞ ‡§â‡§∏‡§ï‡§æ ‡§∏‡§æ‡§∞ ‡§¨‡§§‡§æ‡§Ø‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ‡•§"></textarea>
      </div>

      <div class="card panel">
        <h2>‡§ë‡§´‡§º‡§≤‡§æ‡§á‡§® ‡§π‡§æ‡§à‚Äë‡§™‡•ç‡§∞‡§ø‡§∏‡•Ä‡§ú‡§® (‡§µ‡•à‡§ï‡§≤‡•ç‡§™‡§ø‡§ï)</h2>
        <ol class="muted">
          <li>‡§á‡§∏‡•Ä ‡§´‡§æ‡§á‡§≤ ‡§ï‡•á ‡§¨‡§ó‡§≤ ‡§Æ‡•á‡§Ç <code>swe</code> ‡§®‡§æ‡§Æ ‡§ï‡§æ ‡§´‡§º‡•ã‡§≤‡•ç‡§°‡§∞ ‡§¨‡§®‡§æ‡§á‡§è‡•§</li>
          <li>‡§â‡§∏‡§Æ‡•á‡§Ç Swiss Ephemeris WASM/‡§°‡•á‡§ü‡§æ ‡§´‡§æ‡§á‡§≤‡•á‡§Ç ‡§∞‡§ñ‡•á‡§Ç (‡§â‡§¶‡§æ. <code>swe.wasm</code>, <code>sepl_18.se1</code>‚Ä¶)‡•§</li>
          <li>‡§ä‡§™‡§∞ ‚Äú‡§π‡§æ‡§à‚Äë‡§™‡•ç‡§∞‡§ø‡§∏‡•Ä‡§ú‡§® ‡§Æ‡•ã‡§°‚Äù ‡§ë‡§® ‡§ï‡§∞‡•á‡§Ç ‚Äî ‡§∏‡•ç‡§ü‡•á‡§ü‡§∏ ‡§ü‡•à‡§ó "Precision: Swiss WASM" ‡§¶‡§ø‡§ñ‡•á‡§ó‡§æ‡•§</li>
        </ol>
      </div>
    </section>
  </main>

<script>
/*****************************************
 * Kundli Engine (No API)
 * ‚Äì Sidereal (Lahiri), Equal Houses
 * ‚Äì North‚ÄëIndian chart, SVG/PNG/TXT
 * ‚Äì Hindi Interpretation
 * ‚Äì Optional Swiss Ephemeris WASM
 *****************************************/
const D2R=Math.PI/180, R2D=180/Math.PI;
const ZODIAC=["Mesha","Vrishabha","Mithuna","Karka","Simha","Kanya","Tula","Vrischika","Dhanu","Makara","Kumbha","Meena"];
const NAKS=["Ashwini","Bharani","Krittika","Rohini","Mrigashira","Ardra","Punarvasu","Pushya","Ashlesha","Magha","Purva Phalguni","Uttara Phalguni","Hasta","Chitra","Swati","Vishakha","Anuradha","Jyeshtha","Mula","Purva Ashadha","Uttara Ashadha","Shravana","Dhanishta","Shatabhisha","Purva Bhadrapada","Uttara Bhadrapada","Revati"];
const GRAHAS=["Ascendant","Sun","Moon","Mars","Mercury","Jupiter","Venus","Saturn","Rahu","Ketu"];

// ‡§∏‡•ç‡§µ‡§æ‡§Æ‡§ø‡§§‡•ç‡§µ/‡§â‡§ö‡•ç‡§ö/‡§®‡•Ä‡§ö (‡§∏‡§∞‡§≤ ‡§ü‡•á‡§¨‡§≤)
const OWN_SIGN={ Sun:5, Moon:4, Mars:[1,8], Mercury:[3,6], Jupiter:[9,12], Venus:[2,7], Saturn:[10,11] };
const EXALT={ Sun:[0,10], Moon:[1,3], Mars:[9,28], Mercury:[5,15], Jupiter:[3,5], Venus:[11,27], Saturn:[6,20] };
const DEBIL={ Sun:[6,10], Moon:[7,3], Mars:[3,28], Mercury:[11,15], Jupiter:[9,5], Venus:[5,27], Saturn:[0,20] };

// Julian Day (local -> UTC)
function julianDay(y,m,d,h,tzHours){
  h-=tzHours; // to UTC
  const A=Math.floor((14-m)/12);
  y=y+4800-A; m=m+12*A-3;
  const JDN=d+Math.floor((153*m+2)/5)+365*y+Math.floor(y/4)-Math.floor(y/100)+Math.floor(y/400)-32045;
  return JDN+(h-12)/24; // JD at local civil time
}
function tCent(JD){ return (JD-2451545.0)/36525; }
function obliquity(JD){ const U=(JD-2451545.0)/3652500; const eps=23+(26+((21.448-46.8150*U-0.00059*U*U+0.001813*U*U*U))/60)/60; return eps*D2R; }
function gst(JD){ const T=tCent(JD); let th=280.46061837+360.98564736629*(JD-2451545)+0.000387933*T*T-T*T*T/38710000; th=((th%360)+360)%360; return th/15; }
function lahiriAyanamsha(JD){ const days=JD-2451545.0; const years=days/365.2422; const base=24+7/60; const rate=50.29/3600; return base+rate*years; }
const norm360=x=>((x%360)+360)%360;

// Kepler
function solveKepler(M,e){ M*=D2R; let E=M+e*Math.sin(M)*(1+e*Math.cos(M)); for(let i=0;i<14;i++){ const dE=(E-e*Math.sin(E)-M)/(1-e*Math.cos(E)); E-=dE; if(Math.abs(dE)<1e-12) break; } return E; }

// Planetary elements (low‚Äëprecision)
const ELEMS={
  Mercury:{ a:0.38709893, e:[0.20563069, 0.00002527], I:[7.00487,-23.51/3600], L:[252.25084,149472.67411175], wbar:[77.45645, 573.57/3600], Omega:[48.33167,-446.30/3600] },
  Venus:  { a:0.72333199, e:[0.00677323,-0.00004938], I:[3.39471,-2.86/3600], L:[181.97973,58517.81538729], wbar:[131.53298, 622.65/3600], Omega:[76.68069,-996.89/3600] },
  Earth:  { a:1.00000011, e:[0.01671022,-0.00003804], I:[0.00005,-46.94/3600], L:[100.46645,35999.3728565], wbar:[102.93735,1161.0/3600], Omega:[-11.26064,-18228.25/3600] },
  Mars:   { a:1.52366231, e:[0.09341233, 0.00011902], I:[1.85061,-25.47/3600], L:[355.45332,19140.29934243], wbar:[336.04084,1590.20/3600], Omega:[49.57854,-1020.19/3600] },
  Jupiter:{ a:5.20336301, e:[0.04839266,-0.00012880], I:[1.30530,-4.15/3600], L:[34.40438,3034.74612775], wbar:[14.75385,  7.30/3600], Omega:[100.55615,1217.17/3600] },
  Saturn: { a:9.53707032, e:[0.05415060,-0.00036762], I:[2.48446,  6.11/3600], L:[49.94432,1222.49362201], wbar:[92.43194, -17.59/3600], Omega:[113.71504, -1591.05/3600] },
};
function planetHelioEcliptic(JD,name){ const T=tCent(JD); const el=ELEMS[name]; const a=el.a; const e=el.e[0]+el.e[1]*T; const I=(el.I[0]+el.I[1]*T)*D2R; const L=el.L[0]+el.L[1]*T; const wbar=el.wbar[0]+el.wbar[1]*T; const Omega=el.Omega[0]+el.Omega[1]*T; const M=norm360(L-wbar); const E=solveKepler(M,e); const v=2*Math.atan2(Math.sqrt(1+e)*Math.sin(E/2),Math.sqrt(1-e)*Math.cos(E/2)); const r=a*(1-e*Math.cos(E)); const w=(wbar-Omega)*D2R; const x=r*( Math.cos(Omega*D2R)*Math.cos(w+v) - Math.sin(Omega*D2R)*Math.sin(w+v)*Math.cos(I) ); const y=r*( Math.sin(Omega*D2R)*Math.cos(w+v) + Math.cos(Omega*D2R)*Math.sin(w+v)*Math.cos(I) ); const z=r*( Math.sin(w+v)*Math.sin(I) ); return {x,y,z}; }
function eclipLonLat(x,y,z){ const lon=Math.atan2(y,x); const rxy=Math.hypot(x,y); const lat=Math.atan2(z,rxy); return {lon:norm360(lon*R2D), lat:lat*R2D}; }
function planetGeoEclLon(JD,name){ if(name==="Sun"){ const E=planetHelioEcliptic(JD,"Earth"); const {lon}=eclipLonLat(E.x,E.y,E.z); return norm360(lon+180); } const E=planetHelioEcliptic(JD,"Earth"); const P=planetHelioEcliptic(JD,name); return eclipLonLat(P.x-E.x, P.y-E.y, P.z-E.z).lon; }

// Moon (compact major terms)
function moonLongitude(JD){
  const T=(JD-2451545.0)/36525;
  const L0=norm360(218.3164477+481267.88123421*T-0.0015786*T*T+T*T*T/538841);
  const D=norm360(297.8501921+445267.1114034*T-0.0018819*T*T+T*T*T/545868);
  const M=norm360(357.5291092+35999.0502909*T-0.0001536*T*T);
  const Mp=norm360(134.9633964+477198.8675055*T+0.0087414*T*T);
  const F=norm360(93.2720950+483202.0175233*T-0.0036539*T*T);
  const terms=[[6288774,0,0,1,0],[1274027,2,-1,0,0],[658314,2,-1,-1,0],[213618,2,-2,0,0],[-185116,0,1,0,2],[-114332,0,0,0,2],[58793,2,-1,2,0],[57066,2,-1,-1,0],[53322,0,2,0,0],[45758,2,-2,-2,0],[-40923,0,1,0,0],[-34720,1,1,0,0],[-30383,2,0,0,0]];
  let sum=0; for(const [A,kD,kM,kMp,kF] of terms){ const arg=(kD*D+kM*M+kMp*Mp+kF*F)*D2R; sum+=A*Math.sin(arg); }
  const deltaDeg=sum/1000000*(180/Math.PI);
  return norm360(L0+deltaDeg);
}

// Ascendant & Nodes
function lstHours(JD,lon){ return (gst(JD)+lon/15+24)%24; }
function ascendant(JD,latDeg,lonDeg){ const eps=obliquity(JD); const LST=lstHours(JD,lonDeg)*15*D2R; const phi=latDeg*D2R; let lambda=Math.atan2(Math.sin(LST), Math.cos(LST)*Math.cos(eps)-Math.tan(phi)*Math.sin(eps)); return norm360(lambda*R2D); }
function meanNode(JD){ const T=(JD-2451545.0)/36525; let Omega=125.0445550-1934.1361849*T+0.0020762*T*T+(T*T*T)/467410; return norm360(Omega+180); }

// Helpers
function nakshatra(lon){ const span=360/27; const idx=Math.floor(lon/span); const pada=Math.floor((lon%span)/(span/4))+1; return {name:NAKS[idx],pada}; }
function houseOf(lonSid,ascSid){ const diff=norm360(lonSid-ascSid); return Math.floor(diff/30)+1; }
function dms(deg){ const d=Math.floor(deg); const mfull=(deg-d)*60; const m=Math.floor(mfull); const s=Math.round((mfull-m)*60); return `${d}¬∞ ${m}' ${s}\"`; }
function formatLon(lon){ const sign=Math.floor(lon/30); const d=lon-sign*30; return `${ZODIAC[sign]} ${d.toFixed(2)}¬∞`; }
function statusOf(planet,lon){ const sign=Math.floor(lon/30); const degIn=lon-sign*30; let out=[]; const own=OWN_SIGN[planet]; if(own){ const owns=Array.isArray(own)?own:[own]; if(owns.includes(sign+1)) out.push('‡§∏‡•ç‡§µ‚Äë‡§∞‡§æ‡§∂‡§ø'); }
  const ex=EXALT[planet]; if(ex&&ex[0]===sign&&Math.abs(degIn-ex[1])<1.0) out.push('‡§â‡§ö‡•ç‡§ö ‡§ï‡•á ‡§®‡§ø‡§ï‡§ü');
  const de=DEBIL[planet]; if(de&&de[0]===sign&&Math.abs(degIn-de[1])<1.0) out.push('‡§®‡•Ä‡§ö ‡§ï‡•á ‡§®‡§ø‡§ï‡§ü');
  return out.join(', ')||'‚Äî'; }

// Optional Swiss WASM (‡§Ø‡§¶‡§ø ‡§Æ‡•å‡§ú‡•Ç‡§¶)
let swe=null; async function tryLoadSwiss(){ if(!document.getElementById('hiPrec').checked){ swe=null; document.getElementById('precTag').textContent='Precision: Standard'; return false; }
  try{ if(!window.createModule){ await import('./swe/swe.js').catch(()=>{}); }
    if(typeof createModule!=="function") throw new Error('no wasm');
    swe=await createModule(); document.getElementById('precTag').textContent='Precision: Swiss WASM'; return true;
  }catch(e){ swe=null; document.getElementById('precTag').textContent='Precision: Standard'; return false; }
}

async function compute(useSwiss){
  const name=(document.getElementById('name').value||'‚Äî').trim();
  const dob=document.getElementById('dob').value; if(!dob){ alert('‡§ú‡§®‡•ç‡§Æ ‡§§‡§ø‡§•‡§ø ‡§ö‡•Å‡§®‡•á‡§Ç'); return; }
  const tob=document.getElementById('tob').value||'00:00:00';
  const tz=parseFloat(document.getElementById('tz').value||'0') + (document.getElementById('dst').value==='1'?1:0);
  const lat=parseFloat(document.getElementById('lat').value||'0');
  const lon=parseFloat(document.getElementById('lon').value||'0');
  const [Y,M,D]=dob.split('-').map(Number); const [hh,mm,ss]=tob.split(':').map(Number); const H=(hh||0)+(mm||0)/60+(ss||0)/3600;
  const JD=julianDay(Y,M,D,H,tz); const aya=lahiriAyanamsha(JD);

  // Ascendant (tropical -> sidereal)
  const ascTrop=ascendant(JD,lat,lon); const ascSid=norm360(ascTrop-aya);
  const L={}; L['Ascendant']=ascSid;

  // Tropical longitudes -> sidereal
  function lonTrop(p){ if(p==='Moon') return moonLongitude(JD); if(p==='Sun' || ELEMS[p]) return planetGeoEclLon(JD,p==='Ketu'?'Moon':p); return 0; }
  L.Sun=norm360(lonTrop('Sun')-aya);
  L.Moon=norm360(lonTrop('Moon')-aya);
  L.Mars=norm360(lonTrop('Mars')-aya);
  L.Mercury=norm360(lonTrop('Mercury')-aya);
  L.Jupiter=norm360(lonTrop('Jupiter')-aya);
  L.Venus=norm360(lonTrop('Venus')-aya);
  L.Saturn=norm360(lonTrop('Saturn')-aya);
  const rahuTrop=meanNode(JD); L.Rahu=norm360(rahuTrop-aya); L.Ketu=norm360(L.Rahu+180);
  // (Swiss WASM ‡§Æ‡•å‡§ú‡•Ç‡§¶ ‡§π‡•ã ‡§§‡•ã ‡§Ø‡§π‡§æ‡§Å override ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç)

  // Table render
  const tbody=document.querySelector('#tbl tbody'); tbody.innerHTML=''; const rows=[];
  for(const g of GRAHAS){ const lonSid=L[g]; const sign=Math.floor(lonSid/30); const nk=nakshatra(lonSid); const house=houseOf(lonSid,ascSid); const tr=document.createElement('tr'); const stat=statusOf(g,lonSid); const cells=[g, `${formatLon(lonSid)} (${dms(lonSid)})`, ZODIAC[sign], `${nk.name} ${nk.pada}`, house, stat];
    for(const v of cells){ const td=document.createElement('td'); td.textContent=v; tr.appendChild(td); } tbody.appendChild(tr);
    rows.push({graha:g,lon:lonSid,sign,house,nk:`${nk.name} ${nk.pada}`}); }

  document.getElementById('ayanamshaLbl').textContent=`Ayanamsha (Lahiri): ${aya.toFixed(2)}¬∞`;
  document.getElementById('ascLbl').textContent=`Asc: ${formatLon(ascSid)}`;
  document.getElementById('nakLbl').textContent=`‡§ö‡§Ç‡§¶‡•ç‡§∞ ‡§®‡§ï‡•ç‡§∑‡§§‡•ç‡§∞: ${nakshatra(L['Moon']).name}`;

  drawNorthChart(ascSid, rows.filter(r=>r.graha!=="Ascendant"));
  renderHouseList(ascSid, rows);
  window.__kundli={name,JD,aya,ascSid,rows};
}

function drawNorthChart(ascSid, items){
  const svg=document.getElementById('chart'); while(svg.firstChild) svg.removeChild(svg.firstChild);
  const W=800,H=800; const cx=W/2, cy=H/2, R=320; svg.setAttribute('viewBox',`0 0 ${W} ${H}`);
  const g=(tag,attrs)=>{const e=document.createElementNS('http://www.w3.org/2000/svg',tag); for(const k in attrs) e.setAttribute(k,attrs[k]); svg.appendChild(e); return e;};
  const grp=(tag,attrs)=>{const e=document.createElementNS('http://www.w3.org/2000/svg',tag); for(const k in attrs) e.setAttribute(k,attrs[k]); return e;};
  const pts=[[cx,cy-R],[cx+R,cy],[cx,cy+R],[cx-R,cy]].map(p=>p.join(',')).join(' ');
  g('polygon',{points:pts,fill:'#0a0f2a',stroke:'#3a4585','stroke-width':3});
  const lines=[[cx,cy-R,cx+R,cy],[cx+R,cy,cx,cy+R],[cx,cy+R,cx-R,cy],[cx-R,cy,cx,cy-R],[cx,cy-R,cx,cy+R],[cx-R,cy,cx+R,cy]]; for(const [x1,y1,x2,y2] of lines){ g('line',{x1,y1,x2,y2,stroke:'#2a3366','stroke-width':2}); }
  const houseCenters=[[cx,cy-R+80],[cx+130,cy-130],[cx+R-80,cy],[cx+130,cy+130],[cx,cy+R-80],[cx-130,cy+130],[cx-R+80,cy],[cx-130,cy-130],[cx,cy-R+190],[cx+190,cy],[cx,cy+190],[cx-190,cy]];
  const ascSign=Math.floor(ascSid/30); for(let i=0;i<12;i++){ const sign=(ascSign+i)%12; const [x,y]=houseCenters[i]; const t=g('text',{x,y,'text-anchor':'middle','dominant-baseline':'middle',fill:'#bcd','font-size':18}); t.textContent=`${i+1}\n${ZODIAC[sign].slice(0,3)}`; }
  const houseMap=Array.from({length:12},()=>[]); for(const it of items){ const h=it.house-1; houseMap[h].push(it); }
  for(let i=0;i<12;i++){ const [x,y]=houseCenters[i]; const list=houseMap[i]; if(!list.length) continue; list.sort((a,b)=>a.lon-b.lon);
    list.forEach((it,idx)=>{ const t=g('text',{x,y:y+22*idx+18,'text-anchor':'middle','dominant-baseline':'middle',fill:'#e8ecff','font-size':16}); const short={Sun:'Su',Moon:'Mo',Mars:'Ma',Mercury:'Me',Jupiter:'Ju',Venus:'Ve',Saturn:'Sa',Rahu:'Ra',Ketu:'Ke'}[it.graha]||it.graha; t.textContent=`${short} ${((it.lon%30).toFixed(1))}`; }); }
  const title=grp('g',{}); svg.appendChild(title); const tt=document.createElementNS('http://www.w3.org/2000/svg','text'); tt.setAttribute('x',cx); tt.setAttribute('y',40); tt.setAttribute('text-anchor','middle'); tt.setAttribute('fill','#cfe1ff'); tt.setAttribute('font-size','20'); tt.textContent='Kundli (North‚ÄëIndian)'; title.appendChild(tt);
}

function renderHouseList(ascSid, rows){
  const box=document.getElementById('houseList'); box.innerHTML=''; const houses=Array.from({length:12},()=>[]); for(const r of rows){ if(r.graha==='Ascendant') continue; houses[r.house-1].push(r); }
  const meanings=[
    '‡§∏‡•ç‡§µ‡§Ø‡§Ç, ‡§¶‡•á‡§π, ‡§∏‡•ç‡§µ‡§≠‡§æ‡§µ, ‡§ú‡•Ä‡§µ‡§® ‡§∂‡§ï‡•ç‡§§‡§ø',
    '‡§ß‡§®, ‡§µ‡§æ‡§£‡•Ä, ‡§™‡§∞‡§ø‡§µ‡§æ‡§∞, ‡§Æ‡•Ç‡§≤‡•ç‡§Ø',
    '‡§≠‡§æ‡§à‚Äë‡§¨‡§π‡§®, ‡§∏‡§æ‡§π‡§∏, ‡§Ö‡§≤‡•ç‡§™ ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ, ‡§ï‡•å‡§∂‡§≤',
    '‡§ò‡§∞, ‡§Æ‡§æ‡§§‡§æ, ‡§∏‡§Ç‡§™‡§§‡•ç‡§§‡§ø, ‡§≠‡§æ‡§µ‡§®‡§æ‡§§‡•ç‡§Æ‡§ï ‡§Ü‡§ß‡§æ‡§∞',
    '‡§∂‡§ø‡§ï‡•ç‡§∑‡§æ, ‡§∞‡§ö‡§®‡§æ‡§§‡•ç‡§Æ‡§ï‡§§‡§æ, ‡§™‡•ç‡§∞‡•á‡§Æ, ‡§∏‡§Ç‡§§‡§æ‡§®',
    '‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø, ‡§∏‡•á‡§µ‡§æ, ‡§¶‡•à‡§®‡§ø‡§ï ‡§ï‡§æ‡§∞‡•ç‡§Ø, ‡§¨‡§æ‡§ß‡§æ‡§è‡§Å',
    '‡§µ‡§ø‡§µ‡§æ‡§π, ‡§∏‡§æ‡§ù‡•á‡§¶‡§æ‡§∞‡•Ä, ‡§∏‡§æ‡§∞‡•ç‡§µ‡§ú‡§®‡§ø‡§ï ‡§µ‡•ç‡§Ø‡§µ‡§π‡§æ‡§∞',
    '‡§Ü‡§Ø‡•Å‡§∑‡•ç‡§Ø, ‡§™‡§∞‡§ø‡§µ‡§∞‡•ç‡§§‡§®, ‡§∞‡§π‡§∏‡•ç‡§Ø, ‡§ã‡§£',
    '‡§≠‡§æ‡§ó‡•ç‡§Ø, ‡§ß‡§∞‡•ç‡§Æ, ‡§â‡§ö‡•ç‡§ö ‡§∂‡§ø‡§ï‡•ç‡§∑‡§æ, ‡§¶‡•Ç‡§∞ ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ',
    '‡§ï‡§∞‡•ç‡§Æ, ‡§ï‡§∞‡§ø‡§Ø‡§∞, ‡§™‡•ç‡§∞‡§§‡§ø‡§∑‡•ç‡§†‡§æ, ‡§Ö‡§ß‡§ø‡§ï‡§æ‡§∞',
    '‡§≤‡§æ‡§≠, ‡§Æ‡§ø‡§§‡•ç‡§∞, ‡§®‡•á‡§ü‡§µ‡§∞‡•ç‡§ï, ‡§Ü‡§ï‡§æ‡§Ç‡§ï‡•ç‡§∑‡§æ‡§è‡§Å',
    '‡§π‡§æ‡§®‡§ø, ‡§Æ‡•ã‡§ï‡•ç‡§∑, ‡§è‡§ï‡§æ‡§Ç‡§§, ‡§µ‡§ø‡§¶‡•á‡§∂‡•Ä ‡§µ‡§ø‡§∑‡§Ø'
  ];
  houses.forEach((arr,i)=>{ const div=document.createElement('div'); div.className='card panel'; const title=document.createElement('h3'); title.textContent=`‡§≠‡§æ‡§µ ${i+1} ‚Äî ${meanings[i]}`; title.style.margin='0 0 6px'; title.style.fontSize='14px'; title.style.color='#d7e4ff'; div.appendChild(title); const p=document.createElement('p'); p.className='muted'; p.textContent=arr.length?(`‡§ó‡•ç‡§∞‡§π: ${arr.map(o=>o.graha).join(', ')}`):'‡§ó‡•ç‡§∞‡§π: ‚Äî'; div.appendChild(p); box.appendChild(div); });
}

function generateInterpretation(){
  const K=window.__kundli; if(!K){ alert('‡§™‡§π‡§≤‡•á ‡§ï‡•Å‡§Ç‡§°‡§≤‡•Ä ‡§ú‡•á‡§®‡§∞‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç'); return; }
  const {ascSid,rows,aya}=K; const ascSign=Math.floor(ascSid/30); const byHouse=Array.from({length:12},()=>[]); for(const r of rows){ if(r.graha==='Ascendant') continue; byHouse[r.house-1].push(r); }
  const houseMean=['‡§∏‡•ç‡§µ‡§Ø‡§Ç ‡§î‡§∞ ‡§ú‡•Ä‡§µ‡§®‚Äë‡§∂‡§ï‡•ç‡§§‡§ø','‡§ß‡§®‚Äë‡§∏‡§Ç‡§ö‡§Ø ‡§î‡§∞ ‡§Æ‡•Ç‡§≤‡•ç‡§Ø','‡§ï‡•å‡§∂‡§≤/‡§≠‡§æ‡§à‚Äë‡§¨‡§π‡§®','‡§ò‡§∞‚Äë‡§™‡§∞‡§ø‡§µ‡§æ‡§∞ ‡§î‡§∞ ‡§≠‡§æ‡§µ‡§®‡§æ‡§è‡§Å','‡§∞‡§ö‡§®‡§æ‡§§‡•ç‡§Æ‡§ï‡§§‡§æ/‡§∂‡§ø‡§ï‡•ç‡§∑‡§æ/‡§∏‡§Ç‡§§‡§æ‡§®','‡§∏‡•á‡§µ‡§æ‚Äë‡§ï‡§æ‡§∞‡•ç‡§Ø/‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø','‡§∏‡§æ‡§ù‡•á‡§¶‡§æ‡§∞‡•Ä/‡§µ‡§ø‡§µ‡§æ‡§π','‡§ó‡•Ç‡§¢‡§º/‡§™‡§∞‡§ø‡§µ‡§∞‡•ç‡§§‡§®/‡§∏‡§æ‡§ù‡§æ ‡§∏‡§Ç‡§∏‡§æ‡§ß‡§®','‡§≠‡§æ‡§ó‡•ç‡§Ø/‡§ß‡§∞‡•ç‡§Æ/‡§∂‡§ø‡§ï‡•ç‡§∑‡§æ','‡§ï‡§∞‡•ç‡§Æ/‡§ï‡§∞‡§ø‡§Ø‡§∞/‡§™‡•ç‡§∞‡§§‡§ø‡§∑‡•ç‡§†‡§æ','‡§≤‡§æ‡§≠/‡§Æ‡§ø‡§§‡•ç‡§∞/‡§®‡•á‡§ü‡§µ‡§∞‡•ç‡§ï','‡§§‡•ç‡§Ø‡§æ‡§ó/‡§Æ‡•Å‡§ï‡•ç‡§§‡§ø/‡§Ö‡§Ç‡§§‡§∞‡•ç‡§Æ‡•Å‡§ñ‡§§‡§æ'];
  const starts=['‡§ï‡•á‡§Ç‡§¶‡•ç‡§∞‡§ø‡§§‡§§‡§æ ‡§∞‡§π‡§§‡•Ä ‡§π‡•à','‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§µ‡§ø‡§∑‡§Ø ‡§π‡•à‡§Ç','‡§ú‡•ã‡§∞ ‡§¶‡§ø‡§ñ‡§§‡§æ ‡§π‡•à','‡§Ö‡§®‡•Å‡§≠‡§µ ‡§π‡•ã‡§®‡•á ‡§ï‡•Ä ‡§∏‡§Æ‡•ç‡§≠‡§æ‡§µ‡§®‡§æ','‡§ä‡§∞‡•ç‡§ú‡§æ ‡§∏‡§Ç‡§ï‡•á‡§Ç‡§¶‡•ç‡§∞‡§ø‡§§ ‡§π‡•ã‡§§‡•Ä ‡§π‡•à'];
  const lines=[`‡§Ø‡§π ‡§ï‡•Å‡§Ç‡§°‡§≤‡•Ä ‡§∏‡§æ‡§á‡§°‡§∞‡•Ä‡§Ø‡§≤ (‡§≤‡§π‡•Ä‡§∞‡•Ä) ‡§Ö‡§Ø‡§®‡§æ‡§Ç‡§∂ ~${aya.toFixed(2)}¬∞ ‡§§‡§•‡§æ Equal Houses ‡§™‡§∞ ‡§Ü‡§ß‡§æ‡§∞‡§ø‡§§ ‡§π‡•à‡•§ ‡§®‡•Ä‡§ö‡•á ‡§ò‡§∞‚Äë‡§µ‡§æ‡§∞ ‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§ï‡§æ ‡§∏‡§∞‡§≤ ‡§π‡§ø‡§®‡•ç‡§¶‡•Ä ‡§µ‡§∞‡•ç‡§£‡§® ‡§¶‡§ø‡§Ø‡§æ ‡§π‡•à:`];
  for(let h=1; h<=12; h++){
    const arr=byHouse[h-1]; const sign=(ascSign+(h-1))%12; const who=arr.length?arr.map(o=>o.graha).join(', '):'‡§ï‡•ã‡§à ‡§ó‡•ç‡§∞‡§π ‡§®‡§π‡•Ä‡§Ç';
    let detail=`${starts[h%starts.length]} ${houseMean[h-1]} ‡§™‡§∞‡•§`;
    if(arr.length){ arr.forEach(o=>{ const s=statusOf(o.graha,o.lon); const deg=(o.lon%30).toFixed(1); let add=`${o.graha} ${ZODIAC[o.sign]} ‡§ï‡•á ${deg}¬∞ ‡§™‡§∞`; if(s&&s!=='‚Äî') add+=` (${s})`; add+=` ‚Äî ‡§á‡§∏ ‡§≠‡§æ‡§µ ‡§ï‡•á ‡§µ‡§ø‡§∑‡§Ø‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§Ö‡§™‡§®‡•á ‡§´‡§≤ ‡§¶‡•á‡§§‡§æ ‡§π‡•à‡•§`; detail+=' '+add; }); }
    lines.push(`‡§≠‡§æ‡§µ ${h} (${ZODIAC[sign]}): ${who}. ${detail}`);
  }
  const text=lines.join('\n\n'); document.getElementById('interpretBox').value=text; return text;
}

// Downloads
function downloadSVG(){ const svg=document.getElementById('chart'); const data=new XMLSerializer().serializeToString(svg); const blob=new Blob([data],{type:'image/svg+xml'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='kundli.svg'; a.click(); URL.revokeObjectURL(a.href); }
function downloadPNG(){ const svg=document.getElementById('chart'); const xml=new XMLSerializer().serializeToString(svg); const img=new Image(); const svg64='data:image/svg+xml;base64,'+btoa(unescape(encodeURIComponent(xml))); img.onload=function(){ const canvas=document.createElement('canvas'); canvas.width=svg.viewBox.baseVal.width; canvas.height=svg.viewBox.baseVal.height; const ctx=canvas.getContext('2d'); ctx.fillStyle='#0c1130'; ctx.fillRect(0,0,canvas.width,canvas.height); ctx.drawImage(img,0,0); canvas.toBlob(b=>{ const a=document.createElement('a'); a.href=URL.createObjectURL(b); a.download='kundli.png'; a.click(); URL.revokeObjectURL(a.href); }); }; img.src=svg64; }
function downloadTXT(){ const text=document.getElementById('interpretBox').value||generateInterpretation(); const blob=new Blob([text],{type:'text/plain;charset=utf-8'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='kundli_report_hindi.txt'; a.click(); URL.revokeObjectURL(a.href); }

// Example
function fillExample(){ document.getElementById('name').value='‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‚Äî ‡§¶‡§ø‡§≤‡•ç‡§≤‡•Ä'; document.getElementById('dob').value='1999-01-15'; document.getElementById('tob').value='14:30:00'; document.getElementById('tz').value='5.5'; document.getElementById('dst').value='0'; document.getElementById('lat').value='28.6139'; document.getElementById('lon').value='77.2090'; }

// Location helpers (no external API)
function setLocStatus(text){ const el=document.getElementById('locStatus'); el.innerHTML=`<span>üìç <strong>‡§≤‡•ã‡§ï‡•á‡§∂‡§®:</strong> <em>${text}</em></span>`; }
function tryAutoTimezone(){ const offsetHours=-new Date().getTimezoneOffset()/60; document.getElementById('tz').value=String(offsetHours); }
function tryAutoGeo(){ if(!('geolocation' in navigator)){ setLocStatus('Geolocation ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç'); return; } navigator.geolocation.getCurrentPosition(pos=>{ const {latitude,longitude}=pos.coords; document.getElementById('lat').value=latitude.toFixed(4); document.getElementById('lon').value=longitude.toFixed(4); setLocStatus(`${latitude.toFixed(4)}, ${longitude.toFixed(4)} (auto)`); },err=>{ setLocStatus('‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§® ‡§Æ‡§ø‡§≤‡§®‡•á ‡§™‡§∞ ‡§ë‡§ü‡•ã‚Äë‡§°‡§ø‡§ü‡•á‡§ï‡•ç‡§ü ‡§¨‡§Ç‡§¶'); }, {enableHighAccuracy:true,timeout:8000,maximumAge:60000}); }
function detectLocation(){ tryAutoTimezone(); tryAutoGeo(); }

// Events
 document.getElementById('calc').addEventListener('click', async()=>{ const ok=await tryLoadSwiss(); compute(ok); });
 document.getElementById('dlSvg').addEventListener('click', downloadSVG);
 document.getElementById('dlPng').addEventListener('click', downloadPNG);
 document.getElementById('dlTxt').addEventListener('click', downloadTXT);
 document.getElementById('example').addEventListener('click', fillExample);
 document.getElementById('makeInterpret').addEventListener('click', generateInterpretation);
 document.getElementById('hiPrec').addEventListener('change', async()=>{ await tryLoadSwiss(); });
 document.getElementById('detectLoc').addEventListener('click', detectLocation);
 document.getElementById('clearLoc').addEventListener('click', ()=>{ setLocStatus('Auto detect ‡§¨‡§Ç‡§¶'); document.getElementById('lat').value=''; document.getElementById('lon').value=''; });
 window.addEventListener('DOMContentLoaded', ()=>{ tryAutoTimezone(); /* best‚Äëeffort */ tryAutoGeo(); });
</script>
</body>
</html>
